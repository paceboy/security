# 安检系统接口协议 - 业务管理端

## 一、通用规范

### 1.1 基础信息
- **基础路径**: `/api`
- **字符编码**: UTF-8
- **数据格式**: JSON

### 1.2 请求头
```
Content-Type: application/json
Authorization: Bearer {token}
```

### 1.3 通用响应格式
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {}
}
```

### 1.4 通用状态码
| 状态码 | 说明 |
|-------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权/Token过期 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 10001 | 业务异常（具体错误见msg） |

### 1.5 分页响应格式
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 100,
    "rows": [],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

### 1.6 时间格式
- 标准时间格式：`yyyy-MM-dd HH:mm:ss`
- 日期格式：`yyyy-MM-dd`

---

## 二、安检记录模块

### 2.1 分页查询安检记录
**GET** `/security/record/list`

**功能说明**: 分页查询安检记录，支持多条件筛选

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| pageNum | Integer | Y | 页码，从1开始 |
| pageSize | Integer | Y | 每页条数，最大100 |
| recordNo | String | N | 记录编号（模糊查询） |
| rfidCode | String | N | RFID标识（精确查询） |
| passengerName | String | N | 旅客姓名（模糊查询） |
| idCard | String | N | 身份证号（模糊查询） |
| checkStatus | Integer | N | 状态：0-待登记，1-登记，2-放行 |
| conclusionType | String | N | 结论类型：高危、安全、开检 |
| hasContraband | Integer | N | 是否有违禁品：0-否，1-是 |
| contrabandCategory | String | N | 违禁类型（来自t_contraband_item.category）：易燃物品、管制刀具等 |
| handleResult | String | N | 处置方式（来自t_contraband_item.handle_result）：暂存、移交公安、快递、自弃、亲友带回 |
| hasTray | Integer | N | 是否有托盘：0-无盘，1-有盘 |
| isOpened | Integer | N | 是否开包：0-否，1-是 |
| beginCheckTime | String | N | 安检时间开始（yyyy-MM-dd HH:mm:ss） |
| endCheckTime | String | N | 安检时间结束（yyyy-MM-dd HH:mm:ss） |
| station | String | N | 安检站点（模糊查询） |
| checkUserName | String | N | 安检员姓名（模糊查询） |

**请求示例**:
```json
{
  "pageNum": 1,
  "pageSize": 10,
  "checkStatus": 2,
  "conclusionType": "高危",
  "hasContraband": 1,
  "contrabandCategory": "易燃物品",
  "handleResult": "暂存",
  "beginCheckTime": "2025-11-01 00:00:00",
  "endCheckTime": "2025-11-25 23:59:59",
  "station": "T1航站楼"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| total | Long | 总记录数 |
| rows | Array | 数据列表 |
| pageNum | Integer | 当前页码 |
| pageSize | Integer | 每页条数 |

**rows数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 主键ID（旅客ID） |
| recordNo | String | 记录编号 |
| checkStatus | Integer | 状态：0-待登记，1-登记，2-放行 |
| checkStatusText | String | 状态文本 |
| faceImageUrl | String | 旅客人脸图片URL |
| rfidCode | String | 托盘RFID标识 |
| packageImages | Array | 包裹图片URL数组 |
| xrayImages | Array | 安检图片/X光图片URL数组 |
| conclusionType | String | 结论类型：高危、安全、开检 |
| isTimeout | Integer | 是否超时：0-否，1-是 |
| contrabandCategories | String | 违禁品类别（多个用逗号分隔） |
| contrabandCount | Integer | 违禁品数量 |
| handleResults | String | 处置方式（多个用逗号分隔） |
| passengerName | String | 旅客姓名 |
| passengerPhone | String | 旅客手机号（来自t_id_card_record.phone） |
| idCard | String | 旅客身份证号（脱敏） |
| checkInStaffName | String | 值机人员姓名 |
| checkInStaffNo | String | 值机人员账号 |
| xrayGenerateTime | String | 安检图片生成时间（X光照片拍摄时间） |
| xrayDeviceId | String | 安检机编号（X光设备ID） |
| checkTime | String | 安检时间 |
| checkUserId | Long | 安检员ID |
| checkUserName | String | 安检员姓名 |
| station | String | 安检站点 |
| isOpened | Integer | 是否开包：0-否，1-是 |
| hasContraband | Integer | 是否有违禁品：0-否，1-是 |
| hasTray | Integer | 是否有托盘：0-无盘，1-有盘 |
| createTime | String | 创建时间 |
| updateTime | String | 更新时间 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 156,
    "pageNum": 1,
    "pageSize": 10,
    "rows": [
      {
        "id": 1001,
        "recordNo": "SC20251121001",
        "checkStatus": 1,
        "checkStatusText": "登记",
        "faceImageUrl": "/upload/face/2025/11/21/f001.jpg",
        "rfidCode": "RFID123456789",
        "packageImages": [
          "/upload/package/2025/11/21/pkg001.jpg",
          "/upload/package/2025/11/21/pkg002.jpg"
        ],
        "xrayImages": [
          "/upload/xray/2025/11/21/xray001.jpg"
        ],
        "conclusionType": "高危",
        "isTimeout": 0,
        "contrabandCategories": "易燃物品",
        "contrabandCount": 1,
        "handleResults": "暂存",
        "passengerName": "张三",
        "passengerPhone": "138****8000",
        "idCard": "310***********1234",
        "checkInStaffName": "王值机",
        "checkInStaffNo": "ZJ001",
        "xrayGenerateTime": "2025-11-21 09:29:30",
        "xrayDeviceId": "XRAY_001",
        "checkTime": "2025-11-21 09:30:00",
        "checkUserId": 101,
        "checkUserName": "李安检",
        "station": "T1航站楼-A区",
        "isOpened": 1,
        "hasContraband": 1,
        "hasTray": 1,
        "createTime": "2025-11-21 09:28:00",
        "updateTime": "2025-11-21 09:35:00"
      }
    ]
  }
}
```

**curl测试示例**:
```bash
# 示例1：基础查询（第1页，每页10条）
curl -X GET \
  "http://192.168.88.94:8080/security/record/list?pageNum=1&pageSize=10" \
  -H "Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VyX2tleSI6IjRhMTM1NjM2LTQ2MTgtNDdkMC1hODFkLWNlMWNiZmI3ODkyNiIsInVzZXJuYW1lIjoiYWRtaW4ifQ.UhW0rAU6iJpKl7nCpdbeme-ZTmgQu1I0ooP-3AbV7Vb9rMSNKjP9IGaeo3iiEnswOx-vc5385kr1d2eMM7OsnQ"

# 示例2：按旅客姓名查询
curl -X GET \
  "http://192.168.88.94:8080/security/record/list?pageNum=1&pageSize=10&passengerName=旅客" \
  -H "Authorization: Bearer <your_token>"

# 示例3：查询开包记录
curl -X GET \
  "http://192.168.88.94:8080/security/record/list?pageNum=1&pageSize=10&isOpened=1" \
  -H "Authorization: Bearer <your_token>"

# 示例4：查询违禁品记录
curl -X GET \
  "http://192.168.88.94:8080/security/record/list?pageNum=1&pageSize=10&hasContraband=1" \
  -H "Authorization: Bearer <your_token>"

# 示例5：按时间范围查询
curl -X GET \
  "http://192.168.88.94:8080/security/record/list?pageNum=1&pageSize=10&beginTime=2025-12-09%2000:00:00&endTime=2025-12-09%2023:59:59" \
  -H "Authorization: Bearer <your_token>"

# 示例6：组合查询-今日所有违禁品记录
curl -X GET \
  "http://192.168.88.94:8080/security/record/list?hasContraband=1&beginTime=2025-12-09%2000:00:00&endTime=2025-12-09%2023:59:59" \
  -H "Authorization: Bearer <your_token>"
```

---

### 2.2 获取安检记录详情
**GET** `/security/record/{id}`

**功能说明**: 获取安检记录完整详情，包含关联的人脸、RFID、包裹照片、X光照片、身份证、违禁品等所有信息

**路径参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| id | Long | Y | 安检记录ID |

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 主键ID |
| recordNo | String | 记录编号 |
| rfidCode | String | RFID标识 |
| idCard | String | 身份证号（完整） |
| trainNumber | String | 乘车车次 |
| travelDate | String | 乘车日期 |
| destination | String | 终点站 |
| checkTime | String | 安检时间 |
| checkStatus | Integer | 状态 |
| checkStatusText | String | 状态文本 |
| conclusionType | String | 结论类型：高危、安全、开检 |
| checkUserId | Long | 安检员ID |
| checkUserName | String | 安检员姓名 |
| station | String | 安检站点 |
| isOpened | Integer | 是否开包 |
| hasContraband | Integer | 是否有违禁品 |
| hasTray | Integer | 是否有托盘 |
| remark | String | 备注 |
| createTime | String | 创建时间 |
| updateTime | String | 更新时间 |
| faceRecord | Object | 人脸记录（1:1关系） |
| rfidRecord | Object | RFID记录（1:1关系） |
| idCardRecord | Object | 身份证记录 |
| packageImages | Array | 包裹照片列表 |
| xrayImages | Array | X光照片列表 |
| contrabandItems | Array | 违禁品列表 |

**faceRecord对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 人脸记录ID |
| deviceId | String | 设备ID |
| faceImageUrl | String | 人脸图片URL |
| captureTime | String | 采集时间 |
| isBound | Integer | 是否已绑定：0-未绑定，1-已绑定 |

**rfidRecord对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | RFID记录ID |
| rfidCode | String | RFID标识 |
| deviceId | String | 设备ID |
| triggerTime | String | 触发时间 |
| source | Integer | 来源：1-托盘RFID，2-开包台扫码枪 |
| sourceText | String | 来源文本 |

**idCardRecord对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 身份证记录ID |
| idCard | String | 身份证号 |
| realName | String | 姓名（优先使用身份证记录中的值，为空则使用主记录的passengerName） |
| gender | Integer | 性别：1-男，2-女 |
| genderText | String | 性别文本 |
| nation | String | 民族 |
| nationality | String | 国籍 |
| birthDate | String | 出生日期 |
| address | String | 地址 |
| phone | String | 手机号 |
| readTime | String | 读取时间 |

**packageImages数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 包裹照片记录ID |
| deviceId | String | 设备ID |
| images | Array | 图片URL数组 |
| captureTime | String | 拍摄时间 |
| hasTray | Integer | 是否有托盘：0-无盘，1-有盘 |

**xrayImages数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | X光照片记录ID |
| deviceId | String | 设备ID |
| images | Array | X光图片URL数组 |
| captureTime | String | 拍摄时间 |
| hasContraband | Integer | 是否有违禁品：0-否，1-是 |

**contrabandItems数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 违禁品ID |
| itemNo | String | 违禁品编号 |
| itemName | String | 违禁品名称 |
| category | String | 类别：易燃物品、管制刀具等 |
| discoverTime | String | 发现时间 |
| handleStatus | Integer | 处理状态：0-待处理，1-已处理 |
| handleStatusText | String | 处理状态文本 |
| handlerUserName | String | 处理人姓名 |
| handleResult | String | 处理结果：暂存、移交公安、快递、自弃、亲友带回 |
| handleTime | String | 处理时间 |
| quantity | Integer | 违禁品数量 |
| contrabandImages | Array | 违禁品照片列表 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "id": 1001,
    "recordNo": "SC20251121001",
    "rfidCode": "RFID123456789",
    "passengerName": "张三",
    "idCard": "310101199001011234",
    "trainNumber": "G128",
    "travelDate": "2025-12-20",
    "destination": "上海虹桥",
    "checkTime": "2025-11-21 09:30:00",
    "checkStatus": 2,
    "checkStatusText": "异常",
    "conclusionType": "高危",
    "checkUserId": 101,
    "checkUserName": "李安检",
    "station": "T1航站楼-A区",
    "isOpened": 1,
    "hasContraband": 1,
    "hasTray": 1,
    "remark": "发现违禁品，已处理",
    "createTime": "2025-11-21 09:28:00",
    "updateTime": "2025-11-21 09:35:00",
    "faceRecord": {
      "id": 2001,
      "deviceId": "FACE_CAM_001",
      "faceImageUrl": "/upload/face/2025/11/21/abc123.jpg",
      "captureTime": "2025-11-21 09:28:00",
      "isBound": 1
    },
    "rfidRecord": {
      "id": 3001,
      "rfidCode": "RFID123456789",
      "deviceId": "RFID_TRAY_001",
      "triggerTime": "2025-11-21 09:28:30",
      "source": 1,
      "sourceText": "托盘RFID"
    },
    "idCardRecord": {
      "id": 6001,
      "idCard": "310101199001011234",
      "realName": "张三",
      "gender": 1,
      "genderText": "男",
      "nation": "汉",
      "birthDate": "1990-01-01",
      "address": "上海市浦东新区XX路XX号",
      "phone": "13800138000",
      "readTime": "2025-11-21 09:27:00"
    },
    "packageImages": [
      {
        "id": 4001,
        "deviceId": "HIK_CAM_001",
        "images": [
          "/upload/package/2025/11/21/pkg001_1.jpg",
          "/upload/package/2025/11/21/pkg001_2.jpg"
        ],
        "captureTime": "2025-11-21 09:29:00",
        "hasTray": 1
      }
    ],
    "xrayImages": [
      {
        "id": 5001,
        "deviceId": "XRAY_001",
        "images": [
          "/upload/xray/2025/11/21/xray001.jpg"
        ],
        "captureTime": "2025-11-21 09:29:30",
        "hasContraband": 1
      }
    ],
    "contrabandItems": [
      {
        "id": 7001,
        "itemNo": "CB20251121001",
        "itemName": "打火机",
        "category": "易燃物品",
        "discoverTime": "2025-11-21 09:30:00",
        "handleStatus": 1,
        "handleStatusText": "已处理",
        "handlerUserName": "李安检",
        "handleResult": "暂存",
        "handleTime": "2025-11-21 09:35:00",
        "quantity": 2,
        "contrabandImages": [
          {
            "id": 8001,
            "images": [
              "/upload/contraband/2025/11/21/cb001.jpg"
            ],
            "captureTime": "2025-11-21 09:35:00"
          }
        ]
      }
    ]
  }
}
```

**curl测试示例**:
```bash
# 查询ID=1的安检记录详情
curl -X GET \
  "http://192.168.88.94:8080/security/record/1" \
  -H "Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VyX2tleSI6IjRhMTM1NjM2LTQ2MTgtNDdkMC1hODFkLWNlMWNiZmI3ODkyNiIsInVzZXJuYW1lIjoiYWRtaW4ifQ.UhW0rAU6iJpKl7nCpdbeme-ZTmgQu1I0ooP-3AbV7Vb9rMSNKjP9IGaeo3iiEnswOx-vc5385kr1d2eMM7OsnQ"
```

---

### 2.3 安检记录登记/修改登记
**POST** `/security/record/register`

**功能说明**: 从安检管理页跳转到登记页面后，提交登记信息。支持首次登记和修改登记两种场景。包含旅客信息、结论类型、违禁品信息的综合登记。此接口会同时更新安检记录、创建/更新身份证记录、创建/更新违禁品记录及违禁品图片。

**场景说明**:
- **首次登记**: 当安检记录状态为 0-待登记 时，更新状态为 1-登记，并保存旅客信息和违禁品信息
- **修改登记**: 当安检记录状态为 1-登记 时，允许修改旅客信息和违禁品信息，状态保持为 1-登记
- **限制**: 当安检记录状态为 2-放行 时，不允许修改，返回错误提示

**图片上传流程**:
1. 前端Pad端拍摄违禁品照片
2. 立即上传到MinIO服务器（调用文件上传接口）
3. 获得MinIO返回的图片URL
4. 将URL数组作为 `images` 字段提交到本登记接口

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| securityCheckId | Long | Y | 安检记录ID |
| rfidCode | String | N | RFID标识（可选，与securityCheckId平级） |
| conclusionType | String | Y | 结论类型：高危、安全、开检 |
| passengerInfo | Object | Y | 旅客信息对象 |
| contrabandList | Array | N | 违禁品列表（有违禁品时必填） |

**passengerInfo 对象**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| idType | String | Y | 证件类型：中国二代身份证、护照等，默认"中国二代身份证" |
| idCard | String | Y | 证件号码 |
| realName | String | Y | 姓名 |
| gender | Integer | N | 性别：1-男，2-女（身份证读取后自动填充） |
| nation | String | N | 民族（身份证读取后自动填充） |
| nationality | String | N | 国籍，如：中国、美国等 |
| birthDate | String | N | 出生日期（身份证读取后自动填充） |
| address | String | N | 地址（身份证读取后自动填充） |
| phone | String | Y | 手机号 |
| trainNumber | String | N | 乘车车次 |
| travelDate | String | N | 乘车日期，格式：yyyy-MM-dd |
| destination | String | N | 终点站 |

**contrabandList 数组元素**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| itemName | String | Y | 违禁品名称 |
| category | String | Y | 违禁品类别：易燃物品、管制刀具 |
| handleResult | String | Y | 处置方式：暂存、移交公安、快递、自弃、亲友带回 |
| images | Array | Y | 违禁品图片URL数组（前端拍摄后上传到MinIO获得URL） |
| remark | String | N | 备注 |

**请求示例**:
```json
{
  "securityCheckId": 1001,
  "rfidCode": "RFID123456",
  "conclusionType": "高危",
  "passengerInfo": {
    "idType": "中国二代身份证",
    "idCard": "310101199001011234",
    "realName": "张三",
    "gender": 1,
    "nation": "汉",
    "nationality": "中国",
    "birthDate": "1990-01-01",
    "address": "上海市浦东新区XX路XX号",
    "phone": "13800138000",
    "trainNumber": "G128",
    "travelDate": "2025-12-20",
    "destination": "上海虹桥"
  },
  "contrabandList": [
    {
      "itemName": "打火机",
      "category": "易燃物品",
      "handleResult": "暂存",
      "images": [
        "https://minio.example.com/contraband/2025/11/21/img001.jpg",
        "https://minio.example.com/contraband/2025/11/21/img002.jpg"
      ],
      "remark": "普通打火机"
    }
  ]
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| securityCheckId | Long | 安检记录ID |
| idCardRecordId | Long | 身份证记录ID |
| contrabandIds | Array | 违禁品ID列表 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "登记成功",
  "data": {
    "securityCheckId": 1001,
    "idCardRecordId": 6001,
    "contrabandIds": [7001]
  }
}
```

**业务逻辑说明**:
1. **校验安检记录状态**：
   - 如果状态为 2-放行，返回错误：记录已放行，不允许修改
   - 如果状态为 0-待登记 或 1-登记，允许继续

2. **更新 `t_security_check_record` 表**：
   - 首次登记：设置 `check_status = 1`（登记）
   - 修改登记：保持 `check_status = 1`
   - 设置 `conclusion_type`（结论类型）
   - 设置 `has_contraband = 1`（如果有违禁品）或 `has_contraband = 0`（无违禁品）
   - 更新 `passenger_name`、`id_card` 字段
   - 如果提供了 `rfidCode`，则更新 `rfid_code` 字段

3. **创建或更新 `t_id_card_record` 表**：
   - 如果该安检记录已关联身份证记录，则更新
   - 否则创建新的身份证记录
   - 关联 `security_check_id`

4. **创建或更新 `t_contraband_item` 记录**：
   - 首次登记：为每个违禁品创建新记录
   - 修改登记：先删除原有违禁品记录，再创建新记录（或根据业务需求保留原记录进行更新）
   - 生成唯一的 `item_no`（违禁品编号）
   - 关联 `security_check_id`
   - 设置 `handle_status = 1`（已处理）

5. **创建 `t_contraband_image_record` 记录**：
   - 前端已将图片上传到MinIO并获得URL
   - 直接保存图片URL数组到 `images` JSON字段
   - 关联 `contraband_id` 和 `security_check_id`

**错误码**:
| 错误码 | 说明 |
|-------|------|
| 10001 | 安检记录不存在 |
| 10011 | 安检记录已放行，不允许修改 |
| 10012 | 违禁品图片数量超过限制 |
| 10013 | 必填字段缺失 |

**curl测试示例**:
```bash
# 安检记录登记
curl -X POST \
  "http://192.168.88.94:9202/security/record/register" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "securityCheckId": 1001,
    "rfidCode": "RFID123456",
    "conclusionType": "高危",
    "passengerInfo": {
      "idType": "中国二代身份证",
      "idCard": "310101199001011234",
      "realName": "张三",
      "gender": 1,
      "nation": "汉",
      "nationality": "中国",
      "birthDate": "1990-01-01",
      "address": "上海市浦东新区XX路XX号",
      "phone": "13800138000"
    },
    "contrabandList": [
      {
        "itemName": "打火机",
        "category": "易燃物品",
        "handleResult": "暂存",
        "images": [
          "https://minio.example.com/contraband/2025/11/21/img001.jpg"
        ],
        "remark": "普通打火机"
      }
    ]
  }'
```

---

### 2.4 新增安检记录
**POST** `/security/record`

**功能说明**: 手动新增安检记录（特殊情况下使用）

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| rfidCode | String | N | RFID标识 |
| passengerName | String | N | 旅客姓名 |
| idCard | String | N | 身份证号 |
| checkTime | String | N | 安检时间，默认当前时间 |
| checkStatus | Integer | N | 状态：0-待登记，1-登记，2-放行，默认0-待登记 |
| conclusionType | String | N | 结论类型：高危、安全、开检 |
| station | String | N | 安检站点 |
| hasTray | Integer | N | 是否有托盘，默认1 |
| remark | String | N | 备注 |

**请求示例**:
```json
{
  "passengerName": "张三",
  "idCard": "310101199001011234",
  "checkTime": "2025-11-21 09:30:00",
  "checkStatus": 0,
  "conclusionType": "安全",
  "station": "T1航站楼-A区",
  "hasTray": 1,
  "remark": "手动录入"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 安检记录ID |
| recordNo | String | 记录编号 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "新增成功",
  "data": {
    "id": 1001,
    "recordNo": "SC20251121001"
  }
}
```

**curl测试示例**:
```bash
# 新增安检记录
curl -X POST \
  "http://192.168.88.94:9202/security/record" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "passengerName": "张三",
    "idCard": "310101199001011234",
    "checkTime": "2025-11-21 09:30:00",
    "checkStatus": 0,
    "conclusionType": "安全",
    "station": "T1航站楼-A区",
    "hasTray": 1,
    "remark": "手动录入"
  }'
```

---

### 2.5 删除安检记录
**POST** `/security/record/delete`

**功能说明**: 批量删除安检记录（软删除或物理删除）

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| ids | Array | Y | 记录ID数组 |

**请求示例**:
```json
{
  "ids": [1001, 1002, 1003]
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

**curl测试示例**:
```bash
# 删除安检记录
curl -X POST \
  "http://192.168.88.94:9202/security/record/delete" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "ids": [1001, 1002, 1003]
  }'
```

---

### 2.6 导出安检记录
**POST** `/security/record/export`

**功能说明**: 根据查询条件导出安检记录为Excel

**请求方式**:
- Content-Type: `application/x-www-form-urlencoded` 或 URL参数
- **注意**: 不支持 JSON Body 方式传参，需使用表单参数或URL参数

**请求参数**: 同2.1查询接口参数（不含分页参数）

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| recordNo | String | N | 记录编号（模糊查询） |
| rfidCode | String | N | RFID标识（精确查询） |
| passengerName | String | N | 旅客姓名（模糊查询） |
| idCard | String | N | 身份证号（模糊查询） |
| checkStatus | Integer | N | 状态：0-待登记，1-登记，2-放行 |
| conclusionType | String | N | 结论类型：高危、安全、开检 |
| hasContraband | Integer | N | 是否有违禁品：0-否，1-是 |
| hasTray | Integer | N | 是否有托盘：0-无盘，1-有盘 |
| isOpened | Integer | N | 是否开包：0-否，1-是 |
| beginCheckTime | String | N | 安检时间开始（yyyy-MM-dd HH:mm:ss） |
| endCheckTime | String | N | 安检时间结束（yyyy-MM-dd HH:mm:ss） |
| station | String | N | 安检站点（模糊查询） |

**响应**: 文件流（application/vnd.ms-excel）

**文件名格式**: `安检记录_yyyyMMdd_HHmmss.xlsx`

**curl测试示例**:
```bash
# 导出安检记录（URL参数方式）
curl -X POST \
  "http://192.168.88.94:8080/security/record/export?checkStatus=1&beginCheckTime=2025-11-01%2000:00:00&endCheckTime=2025-11-25%2023:59:59" \
  -H "Authorization: Bearer <your_token>" \
  -o "安检记录.xlsx"

# 导出安检记录（表单参数方式）
curl -X POST \
  "http://192.168.88.94:8080/security/record/export" \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "checkStatus=1&beginCheckTime=2025-11-01 00:00:00&endCheckTime=2025-11-25 23:59:59" \
  -o "安检记录.xlsx"
```

**前端调用示例**:
```javascript
// 使用 axios 调用导出接口
export function exportRecord(query) {
  return request({
    url: '/security/record/export',
    method: 'post',
    params: query,  // 使用 params 而非 data，确保参数作为URL参数传递
    responseType: 'blob'
  })
}
```

---

### 2.7 更新安检记录状态
**POST** `/security/record/updateStatus`

**功能说明**: 更新安检记录的状态，支持更新为待登记、登记、放行三个状态

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| id | Long | Y | 安检记录ID |
| checkStatus | Integer | Y | 目标状态：0-待登记，1-登记，2-放行 |

**请求示例**:
```json
{
  "id": 1001,
  "checkStatus": 2
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "更新成功",
  "data": null
}
```

**业务规则**:
1. 状态值必须是 0（待登记）、1（登记）或 2（放行）之一
2. 如果记录不存在，返回错误提示
3. 如果目标状态与当前状态相同，直接返回成功（不重复更新）
4. 更新状态时，同时更新操作人信息（当前登录用户）
5. 更新 `update_time` 为当前时间
6. 支持任意状态之间的转换（不限制状态流转路径）

**状态说明**:
| 状态值 | 状态名称 | 说明 |
|-------|---------|------|
| 0 | 待登记 | 初始状态，等待安检员登记 |
| 1 | 登记 | 已登记，处理中 |
| 2 | 放行 | 已放行通过 |

**错误码**:
| 错误码 | 说明 |
|-------|------|
| 10001 | 安检记录不存在 |
| 10014 | 状态值无效，必须是0(待登记)、1(登记)或2(放行) |

**curl测试示例**:
```bash
# 更新为放行状态
curl -X POST \
  "http://192.168.88.94:8080/security/record/updateStatus" \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1001,
    "checkStatus": 2
  }'

# 更新为登记状态
curl -X POST \
  "http://192.168.88.94:8080/security/record/updateStatus" \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1001,
    "checkStatus": 1
  }'

# 更新为待登记状态
curl -X POST \
  "http://192.168.88.94:8080/security/record/updateStatus" \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1001,
    "checkStatus": 0
  }'
```

---

### 2.8 获取包裹统计数据
**GET** `/security/record/packageStats`

**功能说明**: 获取包裹统计数据，包括近3个月和今日的总包裹数、异常包裹数、今日异常登记数

**请求参数**: 无

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalPackages | Long | 总包裹数（近3个月） |
| abnormalPackages | Long | 异常包裹数（近3个月，待登记+已登记） |
| todayTotalPackages | Long | 今日总包裹数 |
| todayAbnormalPackages | Long | 今日异常包裹数（待登记+已登记） |
| todayRegisteredPackages | Long | 今日异常登记数（已登记的高危包裹） |

**响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "totalPackages": 22360,
    "abnormalPackages": 9000,
    "todayTotalPackages": 1246,
    "todayAbnormalPackages": 900,
    "todayRegisteredPackages": 450
  }
}
```

**curl测试示例**:
```bash
# 获取包裹统计数据
curl -X GET \
  "http://192.168.88.94:9202/security/record/packageStats" \
  -H "Authorization: Bearer <your_token>"
```

**业务逻辑说明**:
1. **总包裹数（近3个月）**: 统计 `t_security_check_record` 表中 `check_time >= 3个月前` 的所有记录数
2. **异常包裹数（近3个月）**: 统计 `t_security_check_record` 表中 `check_time >= 3个月前` 且 `check_status IN (0, 1)` 的记录数
   - `check_status = 0`: 待登记
   - `check_status = 1`: 已登记
3. **今日总包裹数**: 统计 `t_security_check_record` 表中 `DATE(check_time) = 今天` 的所有记录数
4. **今日异常包裹数**: 统计 `t_security_check_record` 表中 `DATE(check_time) = 今天` 且 `check_status IN (0, 1)` 的记录数
5. **今日异常登记数**: 统计 `t_security_check_record` 表中 `DATE(check_time) = 今天` 且 `check_status = 1` 的记录数（检测异常，开包后确认高危并已登记的包裹）

**数据来源**: `t_security_check_record` 表（安检记录主表）

---

## 三、违禁品模块

### 3.1 分页查询违禁品列表
**GET** `/security/contraband/list`

**功能说明**: 分页查询违禁品记录

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| pageNum | Integer | Y | 页码 |
| pageSize | Integer | Y | 每页条数 |
| itemName | String | N | 违禁品名称（模糊查询） |
| category | String | N | 违禁类型：易燃物品、管制刀具等 |
| passengerName | String | N | 旅客姓名（模糊查询） |
| idCard | String | N | 旅客身份证号（模糊查询） |
| phone | String | N | 旅客手机号（模糊查询） |
| checkInStaffName | String | N | 值机人员姓名（模糊查询） |
| handleResult | String | N | 预处理方式：暂存、移交公安、快递、自弃、亲友带回 |
| handleTimeStart | String | N | 处置时间开始 |
| handleTimeEnd | String | N | 处置时间结束 |

**请求示例**:
```json
{
  "pageNum": 1,
  "pageSize": 10,
  "category": "易燃物品",
  "handleResult": "暂存",
  "handleTimeStart": "2025-11-01 00:00:00",
  "handleTimeEnd": "2025-11-25 23:59:59"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| total | Long | 总记录数 |
| rows | Array | 数据列表 |

**rows数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 违禁品ID |
| itemName | String | 违禁品名称 |
| quantity | Integer | 违禁品数量 |
| category | String | 违禁品类型 |
| handleResult | String | 预处理方式：暂存、移交公安、快递、自弃、亲友带回 |
| followupAction | String | 后续处置方式：本人认领、非本人认领、快递（当有认领信息时返回认领方式，当有物流信息时返回"快递"，否则为null）。包含三种情况：1) 本人认领：当claimType为"本人认领"时；2) 非本人认领：当claimType为"非本人认领"时；3) 快递：当logisticsType不为空时，统一返回"快递" |
| passengerName | String | 旅客姓名 |
| idCard | String | 旅客身份证号（脱敏） |
| phone | String | 旅客手机号 |
| checkInStaffName | String | 值机人员姓名 |
| handleTime | String | 处置时间 |
| xrayDeviceId | String | 安检机编号 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 25,
    "pageNum": 1,
    "pageSize": 10,
    "rows": [
      {
        "id": 7001,
        "itemName": "酒、喷雾",
        "quantity": 3,
        "category": "禁止携带",
        "handleResult": "自弃",
        "followupAction": null,
        "passengerName": "张三",
        "idCard": "310***********1234",
        "phone": "13800138000",
        "checkInStaffName": "刘继芝",
        "handleTime": "2017/08/01 12:12:12",
        "xrayDeviceId": "12345"
      },
      {
        "id": 7002,
        "itemName": "喷雾",
        "quantity": 2,
        "category": "禁止携带可托运",
        "handleResult": "暂存",
        "followupAction": "本人认领",
        "passengerName": "张三三",
        "idCard": "123***********909",
        "phone": "13900139000",
        "checkInStaffName": "刘继芝",
        "handleTime": "2017/08/01 12:12:12",
        "xrayDeviceId": "12345"
      },
      {
        "id": 7003,
        "itemName": "打火机",
        "quantity": 1,
        "category": "易燃物品",
        "handleResult": "暂存",
        "followupAction": "非本人认领",
        "passengerName": "李四",
        "idCard": "110***********5678",
        "phone": "13900139001",
        "checkInStaffName": "刘继芝",
        "handleTime": "2017/08/01 12:12:12",
        "xrayDeviceId": "12345"
      },
      {
        "id": 7004,
        "itemName": "充电宝",
        "quantity": 1,
        "category": "超标电池",
        "handleResult": "快递",
        "followupAction": "快递",
        "passengerName": "王五",
        "idCard": "120***********9012",
        "phone": "13900139002",
        "checkInStaffName": "刘继芝",
        "handleTime": "2017/08/01 12:12:12",
        "xrayDeviceId": "12345"
      }
    ]
  }
}
```

**curl测试示例**:
```bash
# 示例1：基础查询（第1页，每页10条）
curl -X GET \
  "http://192.168.88.94:8080/security/contraband/list?pageNum=1&pageSize=10" \
  -H "Authorization: Bearer <your_token>"

# 示例2：按类别查询（查询易燃物品）
curl -X GET \
  "http://192.168.88.94:8080/security/contraband/list?pageNum=1&pageSize=10&category=易燃物品" \
  -H "Authorization: Bearer <your_token>"

# 示例3：按违禁品名称查询
curl -X GET \
  "http://192.168.88.94:8080/security/contraband/list?pageNum=1&pageSize=10&itemName=打火机" \
  -H "Authorization: Bearer <your_token>"

# 示例4：按手机号查询
curl -X GET \
  "http://192.168.88.94:8080/security/contraband/list?pageNum=1&pageSize=10&phone=138" \
  -H "Authorization: Bearer <your_token>"

# 示例5：组合查询（手机号 + 其他条件）
curl -X GET \
  "http://192.168.88.94:8080/security/contraband/list?pageNum=1&pageSize=10&phone=138&category=易燃物品" \
  -H "Authorization: Bearer <your_token>"
```

---

### 3.2 获取违禁品详情
**GET** `/security/contraband/info/{id}`

**功能说明**: 获取违禁品详细信息，包含旅客信息、查获信息、认领信息等

**路径参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| id | Long | Y | 违禁品ID |

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 违禁品ID |
| conclusionType | String | 结论类型：高危、安全、开检 |
| passengerInfo | Object | 旅客信息 |
| contrabandInfo | Object | 查获信息 |
| claimInfo | Object | 认领信息 |
| stationInfo | Object | 车站信息 |
| packageImages | Array | 包裹图片URL数组 |
| xrayImages | Array | 安检图片URL数组 |
| faceImageUrl | String | 旅客人脸图片URL |

**passengerInfo对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| realName | String | 姓名 |
| idType | String | 证件类型 |
| idCard | String | 证件号码 |
| phone | String | 手机号 |
| gender | Integer | 性别：1-男，2-女 |
| genderText | String | 性别文本 |
| nation | String | 民族/国籍 |
| trainNumber | String | 乘车车次 |
| travelDate | String | 乘车日期 |
| destination | String | 终点站 |

**contrabandInfo对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| itemName | String | 违禁品名称 |
| category | String | 违禁品类别 |
| quantity | Integer | 违禁品总数 |
| handleResult | String | 预处理方式 |
| followupAction | String | 后续处置方式：本人认领、非本人认领、快递 |
| contrabandImages | Array | 违禁品图片URL数组 |

**claimInfo对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| claimType | String | 认领方式：本人认领、非本人认领 |
| claimPerson | String | 认领人 |
| claimPhone | String | 认领人联系电话 |
| claimTime | String | 认领时间 |

**stationInfo对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| railwayBureau | String | 所属路局 |
| passengerStation | String | 客运站段 |
| station | String | 所属车站 |
| checkInStaffName | String | 值机人员姓名 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "id": 7001,
    "conclusionType": "高危",
    "passengerInfo": {
      "realName": "张三",
      "idType": "中国二代身份证",
      "idCard": "130928736787878656",
      "phone": "15801448827",
      "gender": 1,
      "genderText": "男",
      "nation": "中国",
      "trainNumber": "G128",
      "travelDate": "2025-08-07",
      "destination": "北京"
    },
    "contrabandInfo": {
      "itemName": "压缩气体喷雾罐、喷雾",
      "category": "禁止携带",
      "quantity": 1,
      "handleResult": "快递",
      "followupAction": "快递",
      "contrabandImages": [
        "/upload/contraband/2025/11/21/cb001.jpg",
        "/upload/contraband/2025/11/21/cb002.jpg"
      ]
    },
    "claimInfo": {
      "claimType": "非本人认领",
      "claimPerson": "张三",
      "claimPhone": "15801448898",
      "claimTime": "2025/09/07 09:06:19"
    },
    "stationInfo": {
      "railwayBureau": "郑州铁路局",
      "passengerStation": "新乡南",
      "station": "新乡南",
      "checkInStaffName": "李继致"
    },
    "packageImages": [
      "/upload/package/2025/11/21/pkg001.jpg"
    ],
    "xrayImages": [
      "/upload/xray/2025/11/21/xray001.jpg"
    ],
    "faceImageUrl": "/upload/face/2025/11/21/face001.jpg"
  }
}
```

**curl测试示例**:
```bash
# 查询ID=1的违禁品详情
curl -X GET \
  "http://192.168.88.94:8080/security/contraband/1" \
  -H "Authorization: Bearer <your_token>"
```

---

### 3.3 新增违禁品
**POST** `/security/contraband`

**功能说明**: 手动新增违禁品记录

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| itemName | String | Y | 违禁品名称 |
| category | String | Y | 违禁品类别 |
| quantity | Integer | Y | 违禁品数量 |
| securityCheckId | Long | Y | 关联安检记录ID |
| remark | String | N | 备注 |

**请求示例**:
```json
{
  "itemName": "打火机",
  "category": "易燃物品",
  "quantity": 1,
  "securityCheckId": 1001,
  "remark": "X光机识别"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 违禁品ID |

**响应示例**:
```json
{
  "code": 200,
  "msg": "新增成功",
  "data": {
    "id": 7001
  }
}
```

---

### 3.4 处理违禁品
**POST** `/security/contraband/handle`

**功能说明**: 处理违禁品，包括设置预处理方式、认领信息、物流信息等

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| id | Long | Y | 违禁品ID |
| handleResult | String | Y | 预处理方式：暂存、移交公安、快递、自弃、亲友带回 |
| claimInfo | Object | N | 认领信息（当需要认领时必填，此时handleResult应为"暂存"，通过claimInfo中的claimType区分本人认领/非本人认领） |
| logisticsInfo | Object | N | 物流信息（当handleResult为"快递"时必填） |
| remark | String | N | 备注 |

**claimInfo对象**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| claimType | String | Y | 认领方式：本人认领、非本人认领 |
| claimPerson | String | Y | 认领人姓名 |
| claimPhone | String | Y | 认领人联系电话（11位手机号） |
| claimIdCard | String | Y | 认领人证件号码（18位身份证号） |

**logisticsInfo对象**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| logisticsType | String | Y | 物流类型：圆通快递、顺丰快递等 |
| trackingNumber | String | Y | 物流单号 |

**请求示例1（暂存）**:
```json
{
  "id": 7001,
  "handleResult": "暂存",
  "remark": "旅客配合处理，已暂存登记"
}
```

**请求示例2（认领）**:
```json
{
  "id": 7002,
  "handleResult": "暂存",
  "claimInfo": {
    "claimType": "非本人认领",
    "claimPerson": "张三",
    "claimPhone": "13800138000",
    "claimIdCard": "310101199001011234"
  },
  "remark": "亲属代为认领"
}
```

**请求示例3（快递）**:
```json
{
  "id": 7003,
  "handleResult": "快递",
  "logisticsInfo": {
    "logisticsType": "圆通快递",
    "trackingNumber": "YT1234567890"
  },
  "remark": "已寄回旅客指定地址"
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "处理成功",
  "data": null
}
```

**业务规则**:
1. 联系方式必须为11位数字，否则提示"请输入11位手机号"
2. 证件号码必须为18位身份证号，否则提示"请输入18位身份证号"
3. 认领信息和物流信息均为必填项，不允许为空，否则在对应字段下方红字提示

---

### 3.5 删除违禁品
**POST** `/security/contraband/delete`

**功能说明**: 批量删除违禁品记录

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| ids | Array | Y | 违禁品ID数组 |

**请求示例**:
```json
{
  "ids": [7001, 7002, 7003]
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

---

### 3.6 获取违禁品类别字典
**GET** `/security/contraband/categories`

**功能说明**: 获取违禁品类别列表，用于下拉选择

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| categories | Array | 类别列表 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "categories": [
      {
        "id": 1,
        "categoryCode": "FLAMMABLE",
        "categoryName": "易燃物品",
        "description": "打火机、火柴等",
        "riskLevel": 3
      },
      {
        "id": 2,
        "categoryCode": "WEAPON",
        "categoryName": "管制刀具",
        "description": "刀具、棍棒等",
        "riskLevel": 4
      }
    ]
  }
}
```

**curl测试示例**:
```bash
# 获取违禁品类别列表（28个类别）
curl -X GET \
  "http://192.168.88.94:8080/security/contraband/categories" \
  -H "Authorization: Bearer <your_token>"
```

---

### 3.7 获取处置方式字典
**GET** `/security/contraband/handleResults`

**功能说明**: 获取处置方式列表，用于下拉选择

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "handleResults": [
      "暂存",
      "移交公安",
      "快递",
      "自弃",
      "亲友带回"
    ]
  }
}
```

---

### 3.8 导出违禁品列表
**POST** `/security/contraband/export`

**功能说明**: 根据查询条件导出违禁品列表为Excel，导出字段参照违禁品详情接口（3.2）的完整字段

**请求参数**: 同3.1查询接口参数（不含分页参数）

**请求示例**:
```json
{
  "itemName": "喷雾",
  "category": "易燃物品",
  "handleResult": "暂存",
  "handleTimeStart": "2025-11-01 00:00:00",
  "handleTimeEnd": "2025-11-25 23:59:59"
}
```

**响应**: 文件流（application/vnd.ms-excel）

**文件名格式**: `违禁品列表_yyyyMMdd_HHmmss.xlsx`

**导出字段**（按详情字段导出）:
| 列名 | 说明 |
|-----|------|
| 违禁品名称 | itemName |
| 违禁品数量 | quantity |
| 违禁品类别 | category |
| 处置方式 | handleResult |
| 后续处置方式 | followupAction（本人认领/非本人认领/快递） |
| 旅客姓名 | passengerName |
| 证件类型 | idType |
| 证件号码 | idCard（完整） |
| 旅客手机号 | phone（完整） |
| 旅客性别 | genderText |
| 民族/国籍 | nation |
| 乘车车次 | trainNumber |
| 乘车日期 | travelDate |
| 终点站 | destination |
| 值机人员姓名 | checkInStaffName |
| 所属路局 | railwayBureau |
| 客运站段 | passengerStation |
| 所属车站 | station |
| 安检机编号 | xrayDeviceId |
| 处置时间 | handleTime |
| 结论类型 | conclusionType |
| 认领人 | claimPerson（如适用） |
| 认领人联系电话 | claimPhone（如适用） |
| 认领时间 | claimTime（如适用） |

**业务说明**:
- 最多支持导出10000条记录
- 超过10000条时，提示用户缩小查询范围
- 导出采用异步方式，前端轮询下载链接

---

## 四、值机人员模块

### 4.1 分页查询值机人员统计
**POST** `/checkin/staff/statistics`

**功能说明**: 分页查询值机人员列表，按员工统计值机时长和次数（基于t_duty_record表）

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| pageNum | Integer | Y | 页码 |
| pageSize | Integer | Y | 每页条数 |
| staffName | String | N | 值机人员姓名（模糊查询） |
| staffNo | String | N | 值机账号（模糊查询） |
| dutyDateStart | String | N | 值机日期开始（yyyy-MM-dd） |
| dutyDateEnd | String | N | 值机日期结束（yyyy-MM-dd），最多查询近1年数据 |

**请求示例**:
```json
{
  "pageNum": 1,
  "pageSize": 10,
  "staffName": "张三",
  "dutyDateStart": "2024-11-01",
  "dutyDateEnd": "2025-11-26"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| total | Long | 总记录数（按员工统计） |
| rows | Array | 数据列表 |

**rows数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| staffId | Long | 值机人员ID（t_check_in_staff.id） |
| staffName | String | 值机人员姓名 |
| staffNo | String | 值机账号 |
| totalDutyHours | String | 总值机时长（小时），超过1万显示为"1.5万"，超过1亿显示为"1.2亿" |
| totalDutyCount | Integer | 总值机次数（查询时间范围内） |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 7,
    "pageNum": 1,
    "pageSize": 10,
    "rows": [
      {
        "staffId": 1,
        "staffName": "张三",
        "staffNo": "zhangsansan",
        "totalDutyHours": "14",
        "totalDutyCount": 2
      },
      {
        "staffId": 2,
        "staffName": "张三三",
        "staffNo": "zhangsansan",
        "totalDutyHours": "8",
        "totalDutyCount": 1
      },
      {
        "staffId": 3,
        "staffName": "赵倩",
        "staffNo": "zhangsansan",
        "totalDutyHours": "4",
        "totalDutyCount": 1
      }
    ]
  }
}
```

**业务规则**:
1. 从 t_duty_record 表中按 staff_no 分组统计值机时长和次数
2. 值机时长 = SUM(duty_duration)，若达到万以上，单位换成"万"；超过亿，单位换成"亿"
3. 值机次数 = COUNT(*)
4. 值机日期最多可筛选近1年时间
5. 导出功能详见接口 4.5

---

### 4.2 获取单个值机人员的详细记录
**POST** `/checkin/staff/dutyRecords`

**功能说明**: 查询指定值机人员的所有值机记录明细

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| pageNum | Integer | Y | 页码 |
| pageSize | Integer | Y | 每页条数 |
| staffId | Long | N | 值机人员ID（staffId和staffNo至少传一个） |
| staffNo | String | N | 值机账号（staffId和staffNo至少传一个） |
| dutyDateStart | String | N | 值机日期开始（yyyy-MM-dd） |
| dutyDateEnd | String | N | 值机日期结束（yyyy-MM-dd） |

**请求示例**:
```json
{
  "pageNum": 1,
  "pageSize": 10,
  "staffNo": "zhangsansan",
  "dutyDateStart": "2024-11-01",
  "dutyDateEnd": "2025-11-26"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| total | Long | 总记录数 |
| rows | Array | 值机记录列表 |

**rows数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 值机记录ID |
| staffName | String | 值机人员姓名 |
| staffNo | String | 值机账号 |
| dutyDuration | Integer | 值机时长（小时） |
| dutyTimeRange | String | 值机时间范围（格式：2017/08/01 16:00-20:00） |
| dutyStartTime | String | 值机开始时间 |
| dutyEndTime | String | 值机结束时间 |
| station | String | 值机站点 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 5,
    "pageNum": 1,
    "pageSize": 10,
    "rows": [
      {
        "id": 101,
        "staffName": "张三",
        "staffNo": "zhangsansan",
        "dutyDuration": 14,
        "dutyTimeRange": "2017/08/01 16:00-20:00",
        "dutyStartTime": "2017-08-01 16:00:00",
        "dutyEndTime": "2017-08-01 20:00:00",
        "station": "T1航站楼-A区"
      },
      {
        "id": 102,
        "staffName": "张三",
        "staffNo": "zhangsansan",
        "dutyDuration": 8,
        "dutyTimeRange": "2017/08/01 06:00-08:00",
        "dutyStartTime": "2017-08-01 06:00:00",
        "dutyEndTime": "2017-08-01 08:00:00",
        "station": "T1航站楼-A区"
      }
    ]
  }
}
```

---

### 4.3 值机人员登录（创建值机记录）
**POST** `/checkin/duty/start`

**功能说明**: 值机人员登录，创建值机记录并记录开始时间

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| staffId | Long | Y | 值机人员ID |
| staffNo | String | Y | 工号 |
| staffName | String | Y | 姓名 |
| station | String | N | 值机站点 |

**请求示例**:
```json
{
  "staffId": 1,
  "staffNo": "ZJ001",
  "staffName": "王值机",
  "station": "T1航站楼-A区"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| dutyRecordId | Long | 值机记录ID |
| dutyStartTime | String | 值机开始时间 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "登录成功",
  "data": {
    "dutyRecordId": 101,
    "dutyStartTime": "2025-11-26 08:00:00"
  }
}
```

---

### 4.4 值机人员注销（结束值机记录）
**POST** `/checkin/duty/end`

**功能说明**: 值机人员注销，更新值机记录的结束时间并计算时长

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| dutyRecordId | Long | Y | 值机记录ID |

**请求示例**:
```json
{
  "dutyRecordId": 101
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| dutyRecordId | Long | 值机记录ID |
| dutyStartTime | String | 值机开始时间 |
| dutyEndTime | String | 值机结束时间 |
| dutyDuration | Integer | 值机时长（小时） |

**响应示例**:
```json
{
  "code": 200,
  "msg": "注销成功",
  "data": {
    "dutyRecordId": 101,
    "dutyStartTime": "2025-11-26 08:00:00",
    "dutyEndTime": "2025-11-26 16:00:00",
    "dutyDuration": 8
  }
}
```

**业务逻辑**:
1. 根据dutyRecordId查询值机记录
2. 更新duty_end_time为当前时间
3. 计算duty_duration = (duty_end_time - duty_start_time) / 3600（转换为小时）
4. 更新记录到数据库

---

### 4.5 导出值机人员统计
**POST** `/checkin/staff/statistics/export`

**功能说明**: 根据查询条件导出值机人员统计数据为Excel

**请求参数**: 同4.1查询接口参数（不含分页参数）

**请求示例**:
```json
{
  "staffName": "张三",
  "staffNo": "zhangsansan",
  "dutyDateStart": "2024-11-01",
  "dutyDateEnd": "2025-11-26"
}
```

**响应**: 文件流（application/vnd.ms-excel）

**文件名格式**: `值机人员统计_yyyyMMdd_HHmmss.xlsx`

**导出字段**:
| 列名 | 说明 |
|-----|------|
| 值机人员姓名 | staffName |
| 值机账号 | staffNo |
| 总值机时长（小时） | totalDutyHours |
| 总值机次数 | totalDutyCount |

**业务说明**:
- 最多支持导出20000条记录
- 超过20000条时，提示用户：最多可导出2万条数据，当前超出上限，请调整筛选范围
- 导出采用同步方式，直接返回文件流

---

## 五、数据统计接口

### 5.1 获取首页统计概览
**GET** `/security/statistics/overview`

**功能说明**: 获取首页统计概览数据，包括今日开包数、违禁品数、行李统计

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| date | String | N | 统计日期（yyyy-MM-dd），默认当天 |

**请求示例**:
```
GET /api/security/statistics/overview?date=2025-11-21
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| todayOpenCount | Integer | 今日开包数（实时统计） |
| todayContrabandCount | Integer | 查验违禁品数（实时统计） |
| luggageStats | Object | 今日行李统计 |
| contrabandCategories | Array | 今日违禁类别统计 |

**luggageStats对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalLuggage | Integer | 行李总数 |
| openedCount | Integer | 开包数量 |
| contrabandCount | Integer | 违禁数量 |
| openRate | String | 开包数占比（%），计算公式：开包数量/总安检数 |
| contrabandRate | String | 违禁数占比（%），计算公式：违禁数/总安检数 |

**contrabandCategories数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| category | String | 违禁类别（参照X光机接口） |
| count | Integer | 数量 |
| percentage | String | 占比（%），各个违禁类别占比，以安检机里的类别为准 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "todayOpenCount": 120,
    "todayContrabandCount": 45,
    "luggageStats": {
      "totalLuggage": 1560,
      "openedCount": 120,
      "contrabandCount": 45,
      "openRate": "7.69",
      "contrabandRate": "2.88"
    },
    "contrabandCategories": [
      {
        "category": "刀具",
        "count": 45,
        "percentage": "100.00"
      }
    ]
  }
}
```

**业务说明**:
1. 今日开包数：实时统计当天的开包数量
2. 查验违禁品数：实时统计当天查验的违禁品数量
3. 开包数占比 = 开包数量 / 总安检数 × 100%
4. 违禁数占比 = 违禁数 / 总安检数 × 100%
5. 违禁类别统计参照X光机接口返回的类别数据

**curl测试示例**:
```bash
# 示例1：查询今天的统计数据（默认）
curl -X GET \
  "http://192.168.88.94:8080/security/statistics/overview" \
  -H "Authorization: Bearer <your_token>"

# 示例2：查询指定日期的统计数据
curl -X GET \
  "http://192.168.88.94:8080/security/statistics/overview?date=2025-12-09" \
  -H "Authorization: Bearer <your_token>"
```

---

### 5.2 获取开包数据趋势图
**GET** `/security/statistics/openTrend`

**功能说明**: 获取开包数据趋势，包含行李总数和开包总数，支持按今日/本周/本月维度筛选

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| dimension | String | Y | 维度：today-今日，thisWeek-本周，thisMonth-本月 |

**请求示例**:
```
GET /api/security/statistics/openTrend?dimension=today
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| dimension | String | 维度：today-今日，thisWeek-本周，thisMonth-本月 |
| xAxisData | Array | X轴数据 |
| luggageTotalData | Array | 行李总数数据 |
| openedData | Array | 开包总数数据 |

**响应示例（今日）**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "dimension": "today",
    "xAxisData": ["00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00", "07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"],
    "luggageTotalData": [50, 45, 30, 25, 40, 80, 150, 200, 180, 160, 140, 130, 120, 110, 130, 140, 150, 160, 140, 120, 100, 80, 70, 60],
    "openedData": [5, 3, 2, 1, 3, 6, 12, 18, 15, 13, 11, 10, 9, 8, 10, 11, 12, 13, 11, 9, 8, 6, 5, 4]
  }
}
```

**响应示例（本周）**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "dimension": "thisWeek",
    "xAxisData": ["周一", "周二", "周三", "周四", "周五", "周六", "周日"],
    "luggageTotalData": [1200, 1300, 1250, 1400, 1350, 1100, 900],
    "openedData": [100, 110, 105, 115, 112, 90, 75]
  }
}
```

**响应示例（本月）**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "dimension": "thisMonth",
    "xAxisData": ["第1周", "第2周", "第3周", "第4周"],
    "luggageTotalData": [8500, 9200, 8800, 9500],
    "openedData": [700, 750, 720, 780]
  }
}
```

**业务规则**:
1. 按今日维度筛选：X轴为0-23时（以小时为维度）
2. 按本周筛选：X轴为周一至周日
3. 按本月维度筛选：X轴为自然周（第1周、第2周...）
4. Y轴为数量

**curl测试示例**:
```bash
# 示例1：今日趋势（按小时统计，0-23时）
curl -X GET \
  "http://192.168.88.94:8080/security/statistics/openTrend?dimension=today" \
  -H "Authorization: Bearer <your_token>"

# 示例2：本周趋势（按天统计，周一至周日）
curl -X GET \
  "http://192.168.88.94:8080/security/statistics/openTrend?dimension=thisWeek" \
  -H "Authorization: Bearer <your_token>"

# 示例3：本月趋势（按周统计，第1周、第2周...）
curl -X GET \
  "http://192.168.88.94:8080/security/statistics/openTrend?dimension=thisMonth" \
  -H "Authorization: Bearer <your_token>"
```

---

### 5.3 获取违禁数据趋势图
**GET** `/security/statistics/contrabandTrend`

**功能说明**: 获取违禁数据趋势，包含行李总数和违禁总数，支持按今日/本周/本月维度筛选

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| dimension | String | Y | 维度：today-今日，thisWeek-本周，thisMonth-本月 |

**请求示例**:
```
GET /api/security/statistics/contrabandTrend?dimension=today
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| dimension | String | 维度：today-今日，thisWeek-本周，thisMonth-本月 |
| xAxisData | Array | X轴数据 |
| luggageTotalData | Array | 行李总数数据 |
| contrabandData | Array | 违禁总数数据 |

**响应示例（今日）**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "dimension": "today",
    "xAxisData": ["00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00", "07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"],
    "luggageTotalData": [50, 45, 30, 25, 40, 80, 150, 200, 180, 160, 140, 130, 120, 110, 130, 140, 150, 160, 140, 120, 100, 80, 70, 60],
    "contrabandData": [2, 1, 0, 0, 1, 3, 5, 8, 6, 5, 4, 3, 3, 2, 3, 4, 5, 6, 4, 3, 2, 2, 1, 1]
  }
}
```

**响应示例（本周）**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "dimension": "thisWeek",
    "xAxisData": ["周一", "周二", "周三", "周四", "周五", "周六", "周日"],
    "luggageTotalData": [1200, 1300, 1250, 1400, 1350, 1100, 900],
    "contrabandData": [35, 42, 38, 45, 41, 30, 25]
  }
}
```

**响应示例（本月）**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "dimension": "thisMonth",
    "xAxisData": ["第1周", "第2周", "第3周", "第4周"],
    "luggageTotalData": [8500, 9200, 8800, 9500],
    "contrabandData": [250, 280, 265, 290]
  }
}
```

**业务规则**:
1. 按今日维度筛选：X轴为0-23时（以小时为维度）
2. 按本周筛选：X轴为周一至周日
3. 按本月维度筛选：X轴为自然周（第1周、第2周...）
4. Y轴为数量

**curl测试示例**:
```bash
# 示例1：今日违禁品趋势（按小时统计，0-23时）
curl -X GET \
  "http://192.168.88.94:8080/security/statistics/contrabandTrend?dimension=today" \
  -H "Authorization: Bearer <your_token>"

# 示例2：本周违禁品趋势（按天统计，周一至周日）
curl -X GET \
  "http://192.168.88.94:8080/security/statistics/contrabandTrend?dimension=thisWeek" \
  -H "Authorization: Bearer <your_token>"

# 示例3：本月违禁品趋势（按周统计，第1周、第2周...）
curl -X GET \
  "http://192.168.88.94:8080/security/statistics/contrabandTrend?dimension=thisMonth" \
  -H "Authorization: Bearer <your_token>"
```

---

## 六、登录模块

### 6.1 账号登录
**POST** `/auth/login`

**功能说明**: 用户使用账号密码登录系统

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| username | String | Y | 用户账号 |
| password | String | Y | 密码（至少6位） |

**请求示例**:
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| code | Integer | 状态码：200-成功 |
| msg | String | 返回消息 |
| data | Object | 登录凭证信息 |

**data对象字段**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| access_token | String | JWT访问令牌，后续请求需要在Header中携带 |
| expires_in | Long | 令牌过期时间（分钟），默认720（12小时） |
| userInfo | Object | 用户信息对象 |

**userInfo对象字段**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| userId | Long | 用户ID |
| userName | String | 用户账号 |
| nickName | String | 用户昵称 |
| email | String | 用户邮箱 |
| phonenumber | String | 手机号码 |
| sex | String | 用户性别：0-男，1-女，2-未知 |
| avatar | String | 用户头像URL |
| deptId | Long | 部门ID |
| roles | Array | 角色列表（角色标识字符串数组）|
| permissions | Array | 权限列表（权限标识字符串数组）|

**响应示例**:
```json
{
  "code": 200,
  "msg": null,
  "data": {
    "access_token": "eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VyX2tleSI6IjJkNjVkMzFmLTA5ZjktNDQ5NC05Y2FlLWYyY2MyODA5ODljNSIsInVzZXJuYW1lIjoiYWRtaW4ifQ.S7bF0efO1VP0-ileEJNuUQ91V9SGMrIxbM1hwE6PbHmknJvqznDq-DwLzh8vi9Ucb4G-cefpVQWCUeRLkC5LeA",
    "userInfo": {
      "userId": 1,
      "userName": "admin",
      "nickName": "若依",
      "email": "ry@163.com",
      "phonenumber": "15888888888",
      "sex": "1",
      "avatar": "",
      "deptId": 103,
      "roles": ["admin"],
      "permissions": ["*:*:*"]
    },
    "expires_in": 720
  }
}
```

**业务规则**:
1. 校验用户名和密码是否为空，若为空返回：账号和密码均不能为空
2. 校验用户名是否存在，若不存在返回：账号名不正确
3. 校验密码是否正确，若不正确返回：密码不正确
4. 校验用户状态是否正常（status=0），若被停用返回：账号已被停用
5. 登录成功后生成JWT Token，有效期12小时（720分钟）
6. 更新用户的login_ip和login_date字段
7. 登录成功后返回 userInfo 对象，包含用户完整信息

---

### 6.2 人脸登录
**POST** `/auth/faceLogin`

**功能说明**: 用户使用人脸识别登录系统

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| faceImage | String | Y | 人脸图片Base64编码（或图片URL） |

**请求示例**:
```json
{
  "faceImage": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAA..."
}
```

**响应参数**: 同6.1账号登录

**响应示例**:
```json
{
  "code": 200,
  "msg": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "userId": 2,
      "userName": "zhangsan",
      "nickName": "张三",
      "deptId": 101,
      "deptName": "安检部",
      "roles": ["security_staff"],
      "avatar": "/upload/avatar/zhangsan.jpg"
    }
  }
}
```

**业务规则**:
1. 接收人脸图片，调用人脸识别服务进行特征提取
2. 将提取的特征与sys_user表中所有用户的face_feature进行比对
3. 相似度阈值设置为85%，低于此阈值返回：人脸识别失败
4. 识别成功后，校验用户状态是否正常（status=0）
5. 生成JWT Token，有效期24小时
6. 更新用户的login_ip和login_date字段

---t

### 6.3 退出登录
**POST** `/auth/logout`

**功能说明**: 用户退出登录系统

**请求参数**: 无

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "退出成功",
  "data": null
}
```

**业务规则**:
1. 从请求头中获取token
2. 将token加入黑名单（Redis），防止被重复使用
3. 返回成功

---

### 6.4 修改密码
**PUT** `/system/user/profile/updatePwd`

**功能说明**: 用户修改自己的登录密码

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| oldPassword | String | Y | 原密码 |
| newPassword | String | Y | 新密码（至少6位） |

**请求示例**:
```json
{
  "oldPassword": "admin123",
  "newPassword": "admin456"
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "密码修改成功",
  "data": null
}
```

**业务规则**:
1. 从token中获取当前登录用户ID
2. 校验原密码是否正确，若不正确返回：原密码不正确
3. 校验新密码格式，至少6位字母或数字
4. 使用BCrypt加密新密码
5. 更新sys_user表的password字段
6. 更新pwd_update_date为当前时间

---

## 七、系统设置模块

### 7.1 用户管理

#### 7.1.1 分页查询用户列表
**GET** `/system/user/list`

**功能说明**: 分页查询系统用户列表，支持筛选条件

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| pageNum | Integer | Y | 页码 |
| pageSize | Integer | Y | 每页条数 |
| userName | String | N | 用户名（模糊查询） |
| phonenumber | String | N | 手机号（模糊查询） |
| status | String | N | 状态：空-全部，0-正常，1-停用 |
| deptId | Long | N | 部门ID |

**请求示例**:
```
GET /system/user/list?pageNum=1&pageSize=10&userName=张&status=0
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| total | Long | 总记录数 |
| rows | Array | 数据列表 |

**rows数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| userId | Long | 用户ID |
| userName | String | 用户账号 |
| nickName | String | 用户姓名 |
| deptName | String | 部门名称 |
| phonenumber | String | 手机号码 |
| status | String | 状态（0正常 1停用） |
| createTime | String | 创建时间 |
| roleIds | Array | 角色ID数组 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 25,
    "pageNum": 1,
    "pageSize": 10,
    "rows": [
      {
        "userId": 1,
        "userName": "admin",
        "nickName": "超级管理员",
        "deptName": "安检系统",
        "phonenumber": "15888888888",
        "status": "0",
        "createTime": "2025-11-25 10:00:00",
        "roleIds": [1]
      },
      {
        "userId": 2,
        "userName": "zhangsan",
        "nickName": "张三",
        "deptName": "安检部",
        "phonenumber": "15800001111",
        "status": "0",
        "createTime": "2025-11-26 14:30:00",
        "roleIds": [2, 3]
      }
    ]
  }
}
```

**业务规则**:
1. 用户名、手机号支持模糊查询
2. 状态下拉：全部、启用、停用
3. 部门下拉：显示所有部门树
4. 按创建时间倒序排列

---

#### 7.1.2 新增用户
**POST** `/system/user`

**功能说明**: 新增系统用户（包含人脸采集）

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| userName | String | Y | 用户账号（英文字母/数字，最长20字符） |
| nickName | String | Y | 用户姓名 |
| password | String | Y | 密码（至少6位字母或数字） |
| phonenumber | String | N | 手机号码（11位） |
| deptId | Long | N | 部门ID |
| roleIds | Array | N | 角色ID数组 |
| sex | String | N | 性别（0男 1女 2未知） |
| email | String | N | 邮箱 |
| faceImageUrl | String | N | 人脸图片URL（通过人脸采集接口获取） |
| faceFeature | String | N | 人脸特征数据（通过人脸采集接口获取） |
| status | String | N | 状态（0正常 1停用），默认0 |
| remark | String | N | 备注 |

**请求示例**:
```json
{
  "userName": "lisi",
  "nickName": "李四",
  "password": "123456",
  "phonenumber": "15800002222",
  "deptId": 101,
  "roleIds": [2],
  "sex": "0",
  "email": "lisi@example.com",
  "faceImageUrl": "/upload/face/2025/11/26/face001.jpg",
  "faceFeature": "base64encodedfeaturedata...",
  "status": "0",
  "remark": "安检员"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| userId | Long | 新增的用户ID |

**响应示例**:
```json
{
  "code": 200,
  "msg": "新增成功",
  "data": {
    "userId": 3
  }
}
```

**业务规则**:
1. 用户名必填，支持英文大小写字母、数字，长度限制20个字符
2. 密码必填，至少6位数字或字母
3. 手机号码11位，超出部分不显示
4. 姓名必填
5. 人脸图片和特征可选（如需人脸登录功能，需先调用7.1.7人脸采集接口）
6. 校验用户名唯一性，若重复返回：用户名已存在
7. 使用BCrypt加密密码
8. 保存用户信息到sys_user表
9. 保存用户角色关联到sys_user_role表

---

#### 7.1.3 编辑用户
**PUT** `/system/user/update`

**功能说明**: 编辑用户信息

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| userId | Long | Y | 用户ID |
| nickName | String | Y | 用户姓名 |
| phonenumber | String | N | 手机号码（11位） |
| deptId | Long | N | 部门ID |
| roleIds | Array | N | 角色ID数组 |
| sex | String | N | 性别（0男 1女 2未知） |
| email | String | N | 邮箱 |
| faceImageUrl | String | N | 人脸图片URL（若重新采集） |
| faceFeature | String | N | 人脸特征数据（若重新采集） |
| status | String | N | 状态（0正常 1停用） |
| remark | String | N | 备注 |

**请求示例**:
```json
{
  "userId": 3,
  "nickName": "李四",
  "phonenumber": "15800002222",
  "deptId": 101,
  "roleIds": [2, 3],
  "sex": "0",
  "email": "lisi@example.com",
  "status": "0",
  "remark": "安检员和值机员"
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "修改成功",
  "data": null
}
```

**业务规则**:
1. 编辑时用户名不可修改
2. 其他字段校验规则同新增
3. 更新sys_user表信息
4. 删除旧的用户角色关联，重新插入新的关联关系

---

#### 7.1.4 删除用户
**POST** `/system/user/deleteBatch`

**功能说明**: 删除指定用户（逻辑删除），支持单个或批量删除

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| userIds | Array | Y | 用户ID数组 |

**请求示例**:
```json
{
  "userIds": [3]
}
```

或批量删除：
```json
{
  "userIds": [1, 2, 3]
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

**业务规则**:
1. 点击删除按钮，弹出二次确认弹窗：确认删除该用户？
2. 批量删除时，确认弹窗显示：确认删除选中的 X 个用户？
3. 确认后执行逻辑删除，设置del_flag=2
4. 不能删除admin用户（user_id=1）
5. 不能删除当前登录用户
6. 删除用户时，同时删除用户与角色的关联关系
7. 删除用户时，同时删除用户与岗位的关联关系

---

#### 7.1.5 启用/停用用户
**PUT** `/system/user/changeStatus`

**功能说明**: 启用或停用用户账号

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| userId | Long | Y | 用户ID |
| status | String | Y | 状态（0正常 1停用） |

**请求示例**:
```json
{
  "userId": 3,
  "status": "1"
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "停用成功",
  "data": null
}
```

**业务规则**:
1. 状态为启用时，按钮显示为"停用"
2. 状态为停用时，按钮显示为"启用"
3. 点击按钮弹出二次确认：确认启用/停用该用户？
4. 确认后更新sys_user表的status字段
5. 不能停用admin用户（user_id=1）

---

#### 7.1.6 重置密码
**PUT** `/system/user/resetPwd`

**功能说明**: 管理员重置指定用户的密码

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| userId | Long | Y | 用户ID |
| password | String | Y | 新密码（明文，后端会进行BCrypt加密） |

**请求示例**:
```json
{
  "userId": 3,
  "password": "123456"
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

**错误响应**:
```json
{
  "code": 500,
  "msg": "新密码不能为空"
}
```

**业务规则**:
1. 管理员输入要重置的新密码
2. 新密码不能为空，否则返回错误提示
3. 后端对新密码进行BCrypt加密后更新sys_user表的password字段

---

#### 7.1.7 批量重置密码
**PUT** `/system/user/batchResetPwd`

**功能说明**: 管理员批量重置多个用户的密码为同一个新密码

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| userIds | Long[] | Y | 用户ID数组 |
| password | String | Y | 新密码（明文，后端会进行BCrypt加密） |

**请求示例**:
```json
{
  "userIds": [2, 3, 4],
  "password": "123456"
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

**错误响应**:
```json
{
  "code": 500,
  "msg": "用户ID不能为空"
}
```
```json
{
  "code": 500,
  "msg": "新密码不能为空"
}
```
```json
{
  "code": 500,
  "msg": "不能批量重置当前登录用户的密码"
}
```
```json
{
  "code": 500,
  "msg": "不允许操作超级管理员用户"
}
```

**业务规则**:
1. 管理员输入要重置的用户ID数组和新密码
2. 用户ID数组不能为空
3. 新密码不能为空
4. 不能批量重置当前登录用户的密码
5. 不能重置超级管理员(admin)的密码
6. 会检查每个用户的数据权限
7. 后端对新密码进行BCrypt加密后批量更新sys_user表的password字段

---

#### 7.1.8 人脸采集
**POST** `/system/user/captureFace`

**功能说明**: 采集用户人脸图片并提取特征

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| faceImage | String | Y | 人脸图片Base64编码 |

**请求示例**:
```json
{
  "faceImage": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAA..."
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| faceImageUrl | String | 人脸图片存储URL |
| faceFeature | String | 人脸特征数据（Base64编码） |

**响应示例**:
```json
{
  "code": 200,
  "msg": "人脸采集成功",
  "data": {
    "faceImageUrl": "/upload/face/2025/11/26/face001.jpg",
    "faceFeature": "base64encodedfeaturedata..."
  }
}
```

**业务规则**:
1. 接收前端传来的人脸图片Base64数据
2. 将图片保存到MinIO，返回图片URL
3. 调用人脸识别服务提取人脸特征
4. 返回图片URL和特征数据
5. 前端可重复调用此接口进行重新采集

---

### 7.2 角色管理

#### 7.2.1 分页查询角色列表
**GET** `/system/role/list`

**功能说明**: 分页查询角色列表

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| pageNum | Integer | Y | 页码 |
| pageSize | Integer | Y | 每页条数 |
| roleName | String | N | 角色名称（模糊查询） |
| status | String | N | 状态（0正常 1停用） |

**请求示例**:
```
GET /system/role/list?pageNum=1&pageSize=10&roleName=管理
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| total | Long | 总记录数 |
| rows | Array | 数据列表 |

**rows数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| roleId | Long | 角色ID |
| roleName | String | 角色名称 |
| roleKey | String | 角色权限字符串 |
| roleSort | Integer | 显示顺序 |
| status | String | 状态（0正常 1停用） |
| createTime | String | 创建时间 |
| remark | String | 备注 |
| updateBy | String | 最后操作人 |
| updateTime | String | 更新时间 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 3,
    "pageNum": 1,
    "pageSize": 10,
    "rows": [
      {
        "roleId": 1,
        "roleName": "超级管理员",
        "roleKey": "admin",
        "roleSort": 1,
        "status": "0",
        "createTime": "2025-11-25 10:00:00",
        "remark": "系统管理员角色",
        "updateBy": "admin",
        "updateTime": "2025-12-09 19:00:00"
      },
      {
        "roleId": 2,
        "roleName": "安检员",
        "roleKey": "security_staff",
        "roleSort": 2,
        "status": "0",
        "createTime": "2025-11-25 10:00:00",
        "remark": "安检部门人员角色",
        "updateBy": "admin",
        "updateTime": "2025-12-09 19:00:00"
      }
    ]
  }
}
```

**curl测试示例**:
```bash
# 分页查询角色列表
curl -X GET \
  "http://192.168.88.94:9201/system/role/list?pageNum=1&pageSize=10&roleName=管理" \
  -H "Authorization: Bearer <your_token>"
```

**业务规则**:
1. 按创建时间倒序排列

---

#### 7.2.2 新增角色
**POST** `/system/role`

**功能说明**: 新增角色

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| roleName | String | Y | 角色名称（最长20字符） |
| roleKey | String | N | 角色权限字符串 |
| roleSort | Integer | N | 显示顺序 |
| status | String | N | 状态（0正常 1停用），默认0 |
| menuIds | Array | N | 菜单ID数组（权限配置） |
| remark | String | N | 备注（最长50字符） |

**请求示例**:
```json
{
  "roleName": "财务人员",
  "roleKey": "finance_staff",
  "roleSort": 4,
  "status": "0",
  "menuIds": [1, 2, 3, 100, 101],
  "remark": "财务部门人员"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| roleId | Long | 新增的角色ID |

**响应示例**:
```json
{
  "code": 200,
  "msg": "新增成功",
  "data": {
    "roleId": 4
  }
}
```

**业务规则**:
1. 角色名称不超过20字，超出提示并不允许保存
2. 备注不超过50字，超出提示并不允许保存
3. 校验必填项，若为空提示：该项不能为空
4. 校验角色名称唯一性，若重复返回：角色名称已存在
5. 保存角色信息到sys_role表
6. 保存角色菜单关联到sys_role_menu表

**curl测试示例**:
```bash
# 新增角色
curl -X POST \
  "http://192.168.88.94:9201/system/role" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "roleName": "财务人员",
    "roleKey": "finance_staff",
    "roleSort": 4,
    "status": "0",
    "menuIds": [1, 2, 3, 100, 101],
    "remark": "财务部门人员"
  }'
```

---

#### 7.2.3 编辑角色
**PUT** `/system/role/update`

**功能说明**: 编辑角色信息

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| roleId | Long | Y | 角色ID |
| roleName | String | Y | 角色名称（最长20字符） |
| roleKey | String | N | 角色权限字符串 |
| roleSort | Integer | N | 显示顺序 |
| status | String | N | 状态（0正常 1停用） |
| menuIds | Array | N | 菜单ID数组（权限配置） |
| remark | String | N | 备注（最长50字符） |

**请求示例**:
```json
{
  "roleId": 4,
  "roleName": "财务主管",
  "roleKey": "finance_manager",
  "roleSort": 4,
  "status": "0",
  "menuIds": [1, 2, 3, 100, 101, 102],
  "remark": "财务部门主管"
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "修改成功",
  "data": null
}
```

**业务规则**:
1. 校验规则同新增
2. 不能编辑admin角色（role_id=1）
3. 更新sys_role表信息
4. 删除旧的角色菜单关联，重新插入新的关联关系

**curl测试示例**:
```bash
# 编辑角色
curl -X POST \
  "http://192.168.88.94:9201/system/role/update" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "roleId": 4,
    "roleName": "财务主管",
    "roleKey": "finance_manager",
    "roleSort": 4,
    "status": "0",
    "menuIds": [1, 2, 3, 100, 101, 102],
    "remark": "财务部门主管"
  }'
```

---

#### 7.2.4 批量删除角色
**POST** `/system/role/delete`

**功能说明**: 批量删除指定角色

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| - | Array | Y | 角色ID数组 |

**请求示例**:
```json
[1, 2, 3]
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

**业务规则**:
1. 点击删除按钮，弹出二次确认：确认删除选中的X个角色？（批量删除时）或确认删除该角色？（单个删除时）
2. 不能删除admin角色（role_id=1）
3. 检查是否有用户使用该角色，若有则提示：该角色已分配给用户，无法删除
4. 删除sys_role表记录（逻辑删除，设置del_flag=2）
5. 删除sys_role_menu表的关联记录
6. 支持批量删除，传入角色ID数组

**curl测试示例**:
```bash
# 批量删除角色
curl -X POST \
  "http://192.168.88.94:8080/system/role/delete" \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '[1, 2, 3]'

# 单个删除角色
curl -X POST \
  "http://192.168.88.94:8080/system/role/delete" \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '[4]'
```

---

### 7.3 部门管理

#### 7.3.1 查询部门树列表
**GET** `/system/dept/list`

**功能说明**: 查询部门树形结构列表

**请求参数**: 无

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| data | Array | 部门树数组 |

**data数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| deptId | Long | 部门ID |
| deptName | String | 部门名称 |
| parentId | Long | 父部门ID |
| orderNum | Integer | 显示顺序 |
| leader | String | 负责人 |
| phone | String | 联系电话 |
| status | String | 状态（0正常 1停用） |
| roles | Array | 关联的角色列表 |
| children | Array | 子部门数组（递归结构） |

**roles数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| roleId | Long | 角色ID |
| roleName | String | 角色名称 |
| roleKey | String | 角色权限字符串 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": [
      {
        "deptId": 100,
        "deptName": "安检系统",
        "parentId": 0,
        "orderNum": 0,
        "leader": "管理员",
        "phone": "15888888888",
        "status": "0",
        "roles": [
          {
            "roleId": 1,
            "roleName": "超级管理员",
            "roleKey": "admin"
          }
        ],
        "children": [
          {
            "deptId": 101,
            "deptName": "安检部",
            "parentId": 100,
            "orderNum": 1,
            "leader": "张三",
            "phone": "15800001111",
            "status": "0",
            "roles": [
              {
                "roleId": 2,
                "roleName": "安检员",
                "roleKey": "security_staff"
              }
            ],
            "children": []
          },
          {
            "deptId": 102,
            "deptName": "值机部",
            "parentId": 100,
            "orderNum": 2,
            "leader": "李四",
            "phone": "15800002222",
            "status": "0",
            "roles": [],
            "children": []
          }
        ]
      }
  ]
}
```

**业务规则**:
1. 返回树形结构数据
2. 按order_num排序，相同则按创建时间排序

**curl测试示例**:
```bash
# 查询部门树列表
curl -X GET \
  "http://192.168.88.94:9201/system/dept/list" \
  -H "Authorization: Bearer <your_token>"
```

---

#### 7.3.2 新增部门/新增子部门
**POST** `/system/dept`

**功能说明**: 新增部门（包括顶级部门和子部门）。通过parentId参数区分：parentId=0表示添加顶级部门，parentId为其他部门ID表示添加子部门

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| parentId | Long | Y | 父部门ID（0表示顶级部门，其他值表示在指定部门下添加子部门） |
| deptName | String | Y | 部门名称（最长20字符） |
| orderNum | Integer | N | 显示顺序（默认0） |
| leader | String | N | 负责人 |
| phone | String | N | 联系电话 |
| email | String | N | 邮箱 |
| status | String | N | 状态（0正常 1停用），默认0 |

**请求示例1（添加顶级部门）**:
```json
{
  "parentId": 0,
  "deptName": "华北分公司",
  "orderNum": 1,
  "leader": "张三",
  "phone": "15800001111",
  "email": "north@example.com",
  "status": "0"
}
```

**请求示例2（添加子部门）**:
```json
{
  "parentId": 100,
  "deptName": "后勤部",
  "orderNum": 3,
  "leader": "王五",
  "phone": "15800003333",
  "email": "logistics@example.com",
  "status": "0"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| deptId | Long | 新增的部门ID |

**响应示例**:
```json
{
  "code": 200,
  "msg": "新增成功",
  "data": {
    "deptId": 103
  }
}
```

**业务规则**:
1. 部门名称不超过20字，超出提示并不允许保存
2. 排序值默认为0，越大越靠后，若排序值相同则按创建时间排序
3. 校验必填项，若为空提示：该项不能为空
4. 保存部门信息到sys_dept表
5. 更新ancestors字段（祖级列表）
6. 添加子部门时，parentId必须为已存在的部门ID

**curl测试示例**:
```bash
# 新增部门（顶级部门）
curl -X POST \
  "http://192.168.88.94:9201/system/dept" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "parentId": 0,
    "deptName": "华北分公司",
    "orderNum": 1,
    "leader": "张三",
    "phone": "15800001111",
    "email": "north@example.com",
    "status": "0"
  }'

# 新增子部门
curl -X POST \
  "http://192.168.88.94:9201/system/dept" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "parentId": 100,
    "deptName": "后勤部",
    "orderNum": 3,
    "leader": "王五",
    "phone": "15800003333",
    "email": "logistics@example.com",
    "status": "0"
  }'
```

---

#### 7.3.3 编辑部门
**POST** `/system/dept/update`

**功能说明**: 编辑部门信息

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| deptId | Long | Y | 部门ID |
| parentId | Long | Y | 父部门ID |
| deptName | String | Y | 部门名称（最长20字符） |
| orderNum | Integer | N | 显示顺序 |
| leader | String | N | 负责人 |
| phone | String | N | 联系电话 |
| email | String | N | 邮箱 |
| status | String | N | 状态（0正常 1停用） |
| roleIds | Long[] | N | 关联的角色ID数组（用于管理部门与角色的关联关系） |

**请求示例**:
```json
{
  "deptId": 103,
  "parentId": 100,
  "deptName": "后勤保障部",
  "orderNum": 3,
  "leader": "王五",
  "phone": "15800003333",
  "email": "logistics@example.com",
  "status": "0",
  "roleIds": [1, 2]
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "修改成功",
  "data": null
}
```

**业务规则**:
1. 校验规则同新增
2. 不能将部门设置为自己的子部门
3. 更新sys_dept表信息
4. 更新ancestors字段
5. 如果提供roleIds参数，会更新部门与角色的关联关系（先删除原有关联，再新增新的关联）
6. 如果roleIds为空数组，会清空所有角色关联
7. 如果不提供roleIds参数，保持原有关联不变

**curl测试示例**:
```bash
# 编辑部门（带角色关联）
curl -X POST \
  "http://192.168.88.94:9201/system/dept/update" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "deptId": 103,
    "parentId": 100,
    "deptName": "后勤保障部",
    "orderNum": 3,
    "leader": "王五",
    "phone": "15800003333",
    "email": "logistics@example.com",
    "status": "0",
    "roleIds": [1, 2]
  }'

# 编辑部门（不更新角色关联，不传roleIds参数）
curl -X POST \
  "http://192.168.88.94:9201/system/dept/update" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "deptId": 103,
    "parentId": 100,
    "deptName": "后勤保障部",
    "orderNum": 3,
    "leader": "王五",
    "phone": "15800003333",
    "email": "logistics@example.com",
    "status": "0"
  }'

# 编辑部门（清空角色关联，传空数组）
curl -X POST \
  "http://192.168.88.94:9201/system/dept/update" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "deptId": 103,
    "parentId": 100,
    "deptName": "后勤保障部",
    "orderNum": 3,
    "roleIds": []
  }'
```

---

#### 7.3.4 删除部门
**DELETE** `/system/dept/{depid}`

**功能说明**: 删除指定部门

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| deptId | Long | Y | 部门ID |

**请求示例**:
```
DELETE /system/dept/103
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

**业务规则**:
1. 点击删除按钮，弹出二次确认：确认删除该部门？
2. 检查是否有子部门，若有则提示：存在子部门，无法删除
3. 检查是否有用户归属该部门，若有则提示：部门下有用户，无法删除
4. 删除sys_dept表记录（逻辑删除，设置del_flag=2）

**curl测试示例**:
```bash
# 删除部门
curl -X DELETE \
  "http://192.168.88.94:9201/system/dept/103" \
  -H "Authorization: Bearer <your_token>"
```

---

#### 7.3.5 批量删除部门
**POST** `/system/dept/deleteBatch`

**功能说明**: 批量删除部门

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| deptIds | Array | Y | 部门ID数组 |

**请求示例**:
```json
{
  "deptIds": [103, 104, 105]
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

**curl测试示例**:
```bash
# 批量删除部门
curl -X POST \
  "http://192.168.88.94:9201/system/dept/deleteBatch" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "deptIds": [103, 104, 105]
  }'
```

**业务规则**:
1. 校验是否有勾选部门，若未勾选提示：请先勾选部门，再批量删除
2. 点击批量删除按钮，弹出二次确认：确认删除选中的X个部门？
3. 对每个部门执行7.3.4的校验规则
4. 若有任何部门校验失败，则整个操作失败并提示失败原因

---

### 7.4 菜单管理

#### 7.4.1 获取菜单列表
**GET** `/system/menu/list`

**功能说明**: 获取菜单列表，根据用户角色返回可见的菜单

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| menuName | String | N | 菜单名称（模糊查询） |
| status | String | N | 状态（0正常 1停用） |
| visible | String | N | 显示状态（0显示 1隐藏） |

**请求示例**:
```
GET /system/menu/list?menuName=系统&status=0
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| data | Array | 菜单列表 |

**data数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| menuId | Long | 菜单ID |
| menuName | String | 菜单名称 |
| parentId | Long | 父菜单ID |
| orderNum | Integer | 显示顺序 |
| path | String | 路由地址 |
| component | String | 组件路径 |
| query | String | 路由参数 |
| routeName | String | 路由名称 |
| isFrame | String | 是否为外链（0是 1否） |
| isCache | String | 是否缓存（0缓存 1不缓存） |
| menuType | String | 类型（M目录 C菜单 F按钮） |
| visible | String | 显示状态（0显示 1隐藏） |
| status | String | 菜单状态（0正常 1停用） |
| perms | String | 权限字符串 |
| icon | String | 菜单图标 |
| createTime | String | 创建时间 |
| updateTime | String | 更新时间 |
| remark | String | 备注 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": [
    {
      "menuId": 1,
      "menuName": "系统管理",
      "parentId": 0,
      "orderNum": 1,
      "path": "system",
      "component": "Layout",
      "query": null,
      "routeName": "System",
      "isFrame": "1",
      "isCache": "0",
      "menuType": "M",
      "visible": "0",
      "status": "0",
      "perms": "",
      "icon": "system",
      "createTime": "2025-11-25 10:00:00",
      "updateTime": "2025-11-25 10:00:00",
      "remark": "系统管理目录"
    }
  ]
}
```

**curl测试示例**:
```bash
# 获取菜单列表
curl -X GET \
  "http://192.168.88.94:9201/system/menu/list?menuName=系统&status=0" \
  -H "Authorization: Bearer <your_token>"
```

**业务规则**:
1. 管理员显示所有菜单信息
2. 普通用户只显示有权限的菜单
3. 按显示顺序和创建时间排序

---

#### 7.4.2 根据菜单ID获取详细信息
**GET** `/system/menu/{menuId}`

**功能说明**: 根据菜单ID获取菜单详细信息

**路径参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| menuId | Long | Y | 菜单ID |

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| menuId | Long | 菜单ID |
| menuName | String | 菜单名称 |
| parentId | Long | 父菜单ID |
| orderNum | Integer | 显示顺序 |
| path | String | 路由地址 |
| component | String | 组件路径 |
| query | String | 路由参数 |
| routeName | String | 路由名称 |
| isFrame | String | 是否为外链（0是 1否） |
| isCache | String | 是否缓存（0缓存 1不缓存） |
| menuType | String | 类型（M目录 C菜单 F按钮） |
| visible | String | 显示状态（0显示 1隐藏） |
| status | String | 菜单状态（0正常 1停用） |
| perms | String | 权限字符串 |
| icon | String | 菜单图标 |
| createTime | String | 创建时间 |
| updateTime | String | 更新时间 |
| remark | String | 备注 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "menuId": 1,
    "menuName": "系统管理",
    "parentId": 0,
    "orderNum": 1,
    "path": "system",
    "component": "Layout",
    "query": null,
    "routeName": "System",
    "isFrame": "1",
    "isCache": "0",
    "menuType": "M",
    "visible": "0",
    "status": "0",
    "perms": "",
    "icon": "system",
    "createTime": "2025-11-25 10:00:00",
    "updateTime": "2025-11-25 10:00:00",
    "remark": "系统管理目录"
  }
}
```

**curl测试示例**:
```bash
# 获取菜单详细信息
curl -X GET \
  "http://192.168.88.94:9201/system/menu/1" \
  -H "Authorization: Bearer <your_token>"
```

---

#### 7.4.3 获取菜单下拉树列表
**GET** `/system/menu/treeselect`

**功能说明**: 获取菜单下拉树列表，用于下拉选择组件

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| menuName | String | N | 菜单名称（模糊查询） |
| status | String | N | 状态（0正常 1停用） |

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| data | Array | 菜单树列表 |

**data数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 菜单ID |
| label | String | 菜单名称 |
| children | Array | 子菜单数组（递归结构） |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": [
    {
      "id": 1,
      "label": "系统管理",
      "children": [
        {
          "id": 100,
          "label": "用户管理",
          "children": []
        },
        {
          "id": 101,
          "label": "角色管理",
          "children": []
        }
      ]
    }
  ]
}
```

**curl测试示例**:
```bash
# 获取菜单下拉树列表
curl -X GET \
  "http://192.168.88.94:9201/system/menu/treeselect?status=0" \
  -H "Authorization: Bearer <your_token>"
```

---

#### 7.4.4 加载对应角色菜单列表树
**GET** `/system/menu/roleMenuTreeselect/{roleId}`

**功能说明**: 加载指定角色的菜单列表树，用于角色权限配置

**路径参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| roleId | Long | Y | 角色ID |

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| checkedKeys | Array | 已选中的菜单ID数组 |
| menus | Array | 菜单树列表 |

**menus数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | Long | 菜单ID |
| label | String | 菜单名称 |
| children | Array | 子菜单数组（递归结构） |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "checkedKeys": [1, 100, 101, 102],
    "menus": [
      {
        "id": 1,
        "label": "系统管理",
        "children": [
          {
            "id": 100,
            "label": "用户管理",
            "children": []
          },
          {
            "id": 101,
            "label": "角色管理",
            "children": []
          }
        ]
      }
    ]
  }
}
```

**curl测试示例**:
```bash
# 加载角色菜单列表树
curl -X GET \
  "http://192.168.88.94:9201/system/menu/roleMenuTreeselect/1" \
  -H "Authorization: Bearer <your_token>"
```

---

#### 7.4.5 获取路由信息
**GET** `/system/menu/getRouters`

**功能说明**: 获取前端路由信息，用于动态生成路由

**请求参数**: 无

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| data | Array | 路由列表 |

**data数组元素**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| name | String | 路由名称 |
| path | String | 路由路径 |
| component | String | 组件路径 |
| meta | Object | 路由元信息 |
| children | Array | 子路由数组（递归结构） |

**meta对象**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| title | String | 路由标题 |
| icon | String | 图标 |
| hidden | Boolean | 是否隐藏 |
| noCache | Boolean | 是否不缓存 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": [
    {
      "name": "System",
      "path": "/system",
      "component": "Layout",
      "meta": {
        "title": "系统管理",
        "icon": "system",
        "hidden": false,
        "noCache": false
      },
      "children": [
        {
          "name": "User",
          "path": "user",
          "component": "system/user/index",
          "meta": {
            "title": "用户管理",
            "icon": "user",
            "hidden": false,
            "noCache": false
          },
          "children": []
        }
      ]
    }
  ]
}
```

**curl测试示例**:
```bash
# 获取路由信息
curl -X GET \
  "http://192.168.88.94:9201/system/menu/getRouters" \
  -H "Authorization: Bearer <your_token>"
```

**业务规则**:
1. 只返回当前用户有权限的菜单路由
2. 管理员返回所有路由
3. 普通用户只返回有权限的路由

---

#### 7.4.6 新增菜单
**POST** `/system/menu`

**功能说明**: 新增菜单

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| menuName | String | Y | 菜单名称（最长50字符） |
| parentId | Long | Y | 父菜单ID（0表示顶级菜单） |
| orderNum | Integer | Y | 显示顺序 |
| path | String | N | 路由地址（最长200字符） |
| component | String | N | 组件路径（最长255字符） |
| query | String | N | 路由参数 |
| routeName | String | N | 路由名称 |
| isFrame | String | N | 是否为外链（0是 1否），默认1 |
| isCache | String | N | 是否缓存（0缓存 1不缓存），默认0 |
| menuType | String | Y | 类型（M目录 C菜单 F按钮） |
| visible | String | N | 显示状态（0显示 1隐藏），默认0 |
| status | String | N | 菜单状态（0正常 1停用），默认0 |
| perms | String | N | 权限字符串（最长100字符） |
| icon | String | N | 菜单图标 |
| remark | String | N | 备注 |

**请求示例**:
```json
{
  "menuName": "用户管理",
  "parentId": 1,
  "orderNum": 1,
  "path": "user",
  "component": "system/user/index",
  "query": null,
  "routeName": "User",
  "isFrame": "1",
  "isCache": "0",
  "menuType": "C",
  "visible": "0",
  "status": "0",
  "perms": "system:user:list",
  "icon": "user",
  "remark": "用户管理菜单"
}
```

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| menuId | Long | 新增的菜单ID |

**响应示例**:
```json
{
  "code": 200,
  "msg": "新增成功",
  "data": {
    "menuId": 100
  }
}
```

**curl测试示例**:
```bash
# 新增菜单
curl -X POST \
  "http://192.168.88.94:9201/system/menu" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "menuName": "用户管理",
    "parentId": 1,
    "orderNum": 1,
    "path": "user",
    "component": "system/user/index",
    "menuType": "C",
    "visible": "0",
    "status": "0",
    "perms": "system:user:list",
    "icon": "user",
    "remark": "用户管理菜单"
  }'
```

**业务规则**:
1. 菜单名称不超过50字，超出提示并不允许保存
2. 权限字符串不超过100字，超出提示并不允许保存
3. 校验必填项，若为空提示：该项不能为空
4. 校验菜单名称唯一性，若重复返回：菜单名称已存在
5. 如果是外链，地址必须以http(s)://开头
6. 保存菜单信息到sys_menu表

---

#### 7.4.7 修改菜单
**PUT** `/system/menu`

**功能说明**: 修改菜单信息

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| menuId | Long | Y | 菜单ID |
| menuName | String | Y | 菜单名称（最长50字符） |
| parentId | Long | Y | 父菜单ID |
| orderNum | Integer | Y | 显示顺序 |
| path | String | N | 路由地址（最长200字符） |
| component | String | N | 组件路径（最长255字符） |
| query | String | N | 路由参数 |
| routeName | String | N | 路由名称 |
| isFrame | String | N | 是否为外链（0是 1否） |
| isCache | String | N | 是否缓存（0缓存 1不缓存） |
| menuType | String | Y | 类型（M目录 C菜单 F按钮） |
| visible | String | N | 显示状态（0显示 1隐藏） |
| status | String | N | 菜单状态（0正常 1停用） |
| perms | String | N | 权限字符串（最长100字符） |
| icon | String | N | 菜单图标 |
| remark | String | N | 备注 |

**请求示例**:
```json
{
  "menuId": 100,
  "menuName": "用户管理",
  "parentId": 1,
  "orderNum": 1,
  "path": "user",
  "component": "system/user/index",
  "query": null,
  "routeName": "User",
  "isFrame": "1",
  "isCache": "0",
  "menuType": "C",
  "visible": "0",
  "status": "0",
  "perms": "system:user:list",
  "icon": "user",
  "remark": "用户管理菜单"
}
```

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "修改成功",
  "data": null
}
```

**curl测试示例**:
```bash
# 修改菜单
curl -X PUT \
  "http://192.168.88.94:9201/system/menu" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "menuId": 100,
    "menuName": "用户管理",
    "parentId": 1,
    "orderNum": 1,
    "path": "user",
    "component": "system/user/index",
    "menuType": "C",
    "visible": "0",
    "status": "0",
    "perms": "system:user:list",
    "icon": "user",
    "remark": "用户管理菜单"
  }'
```

**业务规则**:
1. 校验规则同新增
2. 不能将菜单设置为自己的父菜单
3. 更新sys_menu表信息

---

#### 7.4.8 删除菜单
**DELETE** `/system/menu/{menuId}`

**功能说明**: 删除指定菜单

**路径参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| menuId | Long | Y | 菜单ID |

**响应参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

**curl测试示例**:
```bash
# 删除菜单
curl -X DELETE \
  "http://192.168.88.94:9201/system/menu/100" \
  -H "Authorization: Bearer <your_token>"
```

**业务规则**:
1. 点击删除按钮，弹出二次确认：确认删除该菜单？
2. 检查是否有子菜单，若有则提示：存在子菜单,不允许删除
3. 检查是否有角色使用该菜单，若有则提示：菜单已分配,不允许删除
4. 删除sys_menu表记录

---

## 八、文件管理功能

### 8.1 文件上传
**POST** `/upload`

**功能说明**: 上传文件（图片、文档等）到服务器，支持本地存储和MinIO存储两种方式。上传成功后返回文件的访问URL。

**请求方式**: `multipart/form-data`

**请求参数**:
| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| file | File | Y | 要上传的文件（multipart/form-data格式） |

**请求头**:
- 直接访问file服务（端口9300）：无需认证 http://192.168.88.94:9300/upload

**响应参数**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| code | Integer | 状态码：200-成功 |
| msg | String | 返回消息 |
| data | Object | 文件信息对象 |

**data对象字段**:
| 字段名 | 类型 | 说明 |
|-------|------|------|
| name | String | 文件名称（存储后的文件名） |
| url | String | 文件访问URL（完整路径） |


**响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "name": "hik_xray_04E050014FE5D1B5_20260110_114620_593_20260110034620A041_20260110045031A004.jpg",
    "url": "http://192.168.88.94:9300/statics/2026/01/10/hik_xray_04E050014FE5D1B5_20260110_114620_593_20260110034620A041_20260110045031A004.jpg"
  }
}
```

**业务规则**:
1. 文件大小限制：1MB（可通过Nacos配置调整）
2. 支持的文件类型：根据配置允许的扩展名（默认支持常见图片格式）
3. 文件存储路径：`/home/ruoyi/uploadPath/年/月/日/文件名`
4. 文件访问路径：`http://192.168.88.94:9300/statics/年/月/日/文件名`
5. 文件名格式：`原文件名_时间戳_序号.扩展名`

**错误响应**:
```json
{
  "code": 500,
  "msg": "上传文件不能为空"
}
```
```json
{
  "code": 500,
  "msg": "文件名不能为空，请确保Postman中Key为'file'且类型选择'File'"
}
```
```json
{
  "code": 500,
  "msg": "文件大小超过限制"
}
```

**curl测试示例**:

**方式1：直接访问file服务（推荐，无需token）**
```bash
# 直接上传文件到file服务
curl --location 'http://192.168.88.94:9300/upload' \
  --form 'file=@"/Users/paceboy/Downloads/hik_xray_04E050014FE5D1B5_20260110_114620_593_20260110034620A041.jpg"'
```

**Postman配置说明**:
1. Method: `POST`
2. URL: `http://192.168.88.94:9300/upload`（直接访问）或 `http://192.168.88.94:8080/ruoyi-file/upload`（通过网关）
3. Body → form-data：
   - Key: `file`（必须）
   - 类型: `File`（不是Text）
   - Value: 选择文件
4. Headers（通过网关时需要）:
   - `Authorization: Bearer <token>`

**注意事项**:
1. 文件上传接口已加入网关白名单，通过网关访问时无需token（如果已配置白名单）
2. 文件上传后可通过返回的URL直接访问
3. 文件存储在服务器本地路径：`/home/ruoyi/uploadPath`
4. 文件访问路径前缀：`/statics`

**文件访问示例**:
上传成功后，可以通过以下URL访问文件：
```
http://192.168.88.94:9300/statics/2026/01/10/hik_xray_04E050014FE5D1B5_20260110_114620_593_20260110034620A041_20260110045031A004.jpg
```

---

## 附录

### A. 安检状态枚举
| 状态码 | 状态名称 | 说明 |
|-------|---------|------|
| 0 | 待登记 | 待安检员登记处理 |
| 1 | 登记 | 已登记，处理中 |
| 2 | 放行 | 已放行通过 |

### B. 结论类型枚举
| 类型 | 说明 |
|-----|------|
| 异常 | 发现严重违禁品或其他高危情况 |
| 正常 | 正常通过，无安全隐患 |

### C. 违禁品类别枚举
#### 参考X光机
| 类别 | 说明 |
|-----|------|
| 易燃物品 | 打火机、火柴等 |
| 管制刀具 | 刀具、棍棒等 |

**注**: 更多类别可通过接口3.6动态获取

### D. 处置方式枚举
| 处置方式 | 说明 |
|---------|------|
| 暂存 | 暂时存放，返程时领取 |
| 移交公安 | 移交公安机关处理 |
| 快递 | 通过快递寄送 |
| 自弃 | 旅客自愿放弃 |
| 亲友带回 | 由亲友带回 |

### E. 违禁品处理状态枚举
| 状态码 | 状态名称 |
|-------|---------|
| 0 | 待处理 |
| 1 | 已处理 |

### F. RFID来源枚举
| 来源码 | 来源名称 |
|-------|---------|
| 1 | 托盘RFID |
| 2 | 开包台扫码枪 |

### G. 数据脱敏规则
- **身份证号**: 保留前3位和后4位，中间用*代替
  - 示例: 310101199001011234 → 310***********1234
- **手机号**: 保留前3位和后4位，中间用*代替
  - 示例: 13800138000 → 138****8000

### H. 物流类型枚举
| 物流类型 | 说明 |
|---------|------|
| 顺丰快递 | |
| 京东物流 | |
| 邮政EMS | |
| 圆通快递 | |
| 中通快递 | |
| 申通快递 | |
| 韵达快递 | |
| 德邦快递 | |
| 其它 | 其他物流方式 |

### I. 错误码说明
| 错误码 | 说明 | 备注 |
|-------|------|------|
| 10001 | 记录不存在 | |
| 10002 | RFID已绑定 | |
| 10003 | 人脸记录已绑定 | |
| 10004 | 违禁品处理失败 | |
| 10005 | 数据重复提交 | 幂等性检查 |
| 10006 | 状态不允许修改 | |
| 10007 | 工号已存在 | |
| 10008 | 时间窗口匹配失败 | |
| 10009 | 违禁类型不存在 | |
| 10010 | 处置方式不合法 | |
| 10011 | 用户名或密码错误 | |
| 10012 | 人脸识别失败 | |
| 10013 | 用户名已存在 | |
| 10014 | 原密码不正确 | |
| 10015 | 角色名称已存在 | |
| 10016 | 部门名称已存在 | |


### J. 违禁品状态枚举
| 状态码 | 状态名称 |
|-------|---------|
| 0 | 待登记 |
| 1 | 放行 |
| 2 | 登记 |

### K. 违后续处理流程枚举
| 状态码 | 状态名称 |
|-------|---------|
| 0 | 本人认领 |
| 1 | 非本人认领 |
| 2 | **快递 |

---

**文档版本**: v1.2
**最后更新**: 2025-11-27
**维护人**: 系统架构组

**修订记录**:
- v1.2 (2025-11-27): 新增登录模块（账号登录、人脸登录、退出登录、修改密码）；新增系统设置模块（用户管理、角色管理、部门管理）
- v1.1 (2025-11-25): 增加结论类型、违禁类型、处置方式筛选条件；新增处置方式字典接口
- v1.0 (2025-11-25): 初始版本
